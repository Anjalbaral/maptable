<html>
  <head>
    <title>Example</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <!-- Built ressources are loaded using Gulp for these examples -->
    <link rel="stylesheet" href="./maptable.css">
  </head>
  <body>
    <div class="container">
      <div id="ixp_dir"></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js" charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.20/topojson.min.js"></script>
    <!-- Built ressources are loaded using Gulp for these examples -->
    <script src="./maptable.js"></script>
    <script type="text/javascript">
      d3.maptable('#ixp_dir')
        .csv('./data/ixp.csv')
        .map({
          path: "maps/world-110m-wo-antarctica.json",
          autoWidth: true,
          zoom: false,
          scaleHeight: 0.86,
          ratioFromWidth: 0.48,
          watermark: {
            src: 'https://www.pch.net/assets/img/pch_logo.svg',
            width: 130,
            height: 60,
            position: "bottom left",
            style: "opacity:0.1"
          },
          title: {
            bgColor: "#F5F5F5",
            fontSize: "11",
            content: function(a, b, c) {
              if (0 == a || 0 == b) out = "No IXP shown";
              else if (a < b) out = 'Showing <tspan font-weight="bold">' + a + '</tspan> IXP from <tspan font-weight="bold">' + b + "</tspan>";
              else out = '<tspan font-weight="bold">' + b + "</tspan> IXP shown";
              if ("" != c) out += " — " + c;
              return out;
            },
            source: function() {
              return 'Source: <a xlink:href="http://www.pch.net/" target="_blank"><tspan font-weight="bold">pch.net</tspan></a>';
            }
          },
          markers: {
            groupBy: function(a) {
              return a.city + ", " + a.country;
            },
            rollup: function(a) {
              return a.length;
            },
            tooltip: function(a) {
              out = '<div class="arrow"></div>';
              out += '<span class="badge pull-right"> ' + a.values.length + '</span><h3 class="popover-title"> ' + a.key + '</h3>';
              out += '<div class="popover-content">';

              for (i = 0; i < a.values.length; i++) out += " • " + a.values[i].long_name + "<br>";

              out += "</div>";
              return out;
            },
            attr: {
              r: ["min", "max", function(a) {
                return 3 * Math.sqrt(a);
              }],
              fill: "yellow",
              stroke: "#d9d9d9",
              "stroke-width": 0.5,
              filter: "url(#drop-shadow)"
            }
          },
          countries: {
            groupBy: function(a) {
              return a['country_code'];
            },
            rollup: function(a) {
              return a.length;
            },
            attr: {
              fill: ["#a9b6c2", "#6c89a3"],
              stroke: "#d9d9d9",
              "stroke-width": 0.5
            },
            attrEmpty: {
              fill: "#f9f9f9"
            }
          }
        })
        .table({
          rowClassName: function(a) {
            if (a.status != "Active") return "inactive";
            return "";
          },
          className: "table table-striped",
          defaultSorting: {
            key: "city",
            mode: "asc"
          },
          collapseRowsBy: ["region", "country", "city"]
        })
        .filters()
        .render();
      </script>
  </body>
</html>
