<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="bootstrap.min.css">
    <link rel="stylesheet" href="maptable.css">
    <title>MapTable: Basic with Map, Filters and Table - minimal options</title>
</head>
<body>

<script src="d3.min.js" charset="utf-8"></script>
<script src="topojson.min.js"></script>
<script src="maptable.js"></script>

<div id="vizContainer" class='container'></div>

<script>
    var viz = d3.maptable('#vizContainer')
            .json('dir_data.json')
            .map({
              longitudeKey: 'lon',
              latitudeKey: 'lat',
              path: 'ne_110m_admin_0_countries.json',
              filterCountries: function (country) {
                  return country.id !== 'AQ';
              },
              heatmap: {
                mask: false,
                circles: {
                  min: 1,
                  max: 90,
                  step: 4,
                  color: '#0000FF',
                  blur: 6.0,
                  magnitudeScale: function () {
                    var opts = this.options.map.heatmap;
                    var lengthDataset = this.data.filter(function(d) {
                        return parseInt(d.traf, 10) > 0;
                    }).length;
                    var layersPerLocation = (opts.circles.max - opts.circles.min) / opts.circles.step;
                    var maxOpacityScale = d3.scale.linear()
                      .domain([1, lengthDataset * layersPerLocation])
                      .range([1, 1/256]);
                    var centralCircleOpacity = maxOpacityScale(lengthDataset) / lengthDataset;

                    var scale = d3.scale.linear()
                      .domain([
                        this.options.map.heatmap.circles.min,
                        this.options.map.heatmap.circles.max,
                      ])
                      .range([centralCircleOpacity, 0]);
                    return function (m) { return scale(m) };
                  },
                  datumScale: function () {
                    var trafficExtents = d3.extent(this.data, function(d) {
                      return parseInt(d.traf, 10);
                    });
                    if (!trafficExtents[0]) trafficExtents[0] = 0.01;
                    var scale = d3.scale.log()
                      .domain(trafficExtents)
                      .range([0.01, 1.0]);
                    return function (d) {
                      return scale(parseInt(d.traf, 10));
                    };
                  },
                },
                borders: {
                  opacity: 0.2,
                },
              },
              markers: {
                attr: {
                  fill: "yellow",
        					stroke: "#d9d9d9",
        					"stroke-width": 0.5,
                  r: {
          					min: "minValue",
          					max: "maxValue",
          					transform: function(v) {
          						return 3 * Math.sqrt(v);
          					},
          					rollup: function(values) {
          						return values.length;
          					},
          				},
                }
              }
            })
            .render();
</script>
</body>
</html>
