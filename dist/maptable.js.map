{"version":3,"file":"maptable.js","sources":["../src/utils.js","../src/defaultOptions.js","../src/components/Legend.js","../src/components/Watermark.js","../src/components/StackBlur.js","../src/components/GeoMap.js","../src/components/Filters.js","../src/components/Table.js","../src/maptable.js","../src/index.js"],"sourcesContent":["function appendOptions(select, options, defaultValue) {\n  options.forEach(f => {\n    // Filter select\n    const option = document.createElement('option');\n    option.setAttribute('value', f.value);\n    option.innerText = f.text;\n    select.appendChild(option);\n  });\n  select.value = defaultValue;\n}\n\nfunction rangeToBool(el1, range, el2) {\n  if (range === '=') {\n    return parseInt(el1, 10) === parseInt(el2, 10);\n  }\n  if (range === '≠') {\n    return parseInt(el1, 10) !== parseInt(el2, 10) && el1 !== '' && el2 !== '';\n  }\n  if (range === '>') {\n    return parseInt(el1, 10) > parseInt(el2, 10) && el1 !== '' && el2 !== '';\n  }\n  if (range === '<') {\n    return parseInt(el1, 10) < parseInt(el2, 10) && el1 !== '' && el2 !== '';\n  }\n  if (range === '≥') {\n    return parseInt(el1, 10) >= parseInt(el2, 10) && el1 !== '' && el2 !== '';\n  }\n  if (range === '≤') {\n    return parseInt(el1, 10) <= parseInt(el2, 10) && el1 !== '' && el2 !== '';\n  }\n  return true;\n}\n\nfunction extendRecursive() {\n  const dst = {};\n  let src;\n  let p;\n  const args = [].splice.call(arguments, 0);\n  const toString = ({}).toString;\n\n  while (args.length > 0) {\n    src = args.splice(0, 1)[0];\n    if (toString.call(src) === '[object Object]') {\n      for (p in src) {\n        if (src.hasOwnProperty(p)) {\n          if (toString.call(src[p]) === '[object Object]') {\n            dst[p] = extendRecursive(dst[p] || {}, src[p]);\n          } else {\n            dst[p] = src[p];\n          }\n        }\n      }\n    }\n  }\n  return dst;\n}\n\nfunction keyToTile(k) {\n  const upperK = k.charAt(0).toUpperCase() + k.slice(1);\n  return upperK.replace(/_/g, ' ');\n}\n\n/**\n *\n * @param k\n * @returns {string}\n */\nfunction sanitizeKey(k) {\n  return k.toLowerCase()\n  .replace(/ /g, '_')\n  .replace(/\"/g, '')\n  .replace(/'/g, '');\n}\n\nexport default {\n  rangeToBool,\n  appendOptions,\n  extendRecursive,\n  sanitizeKey,\n  keyToTile,\n};\n","export default {\n  map: {\n    longitudeKey: 'longitude',\n    latitudeKey: 'latitude',\n    countryIdentifierKey: 'country_code',\n    countryIdentifierType: 'iso_a2',\n    zoom: true,\n    saveState: true,\n    exportSvg: null,\n    exportSvgClient: false,\n    ratioFromWidth: 0.5,\n    scaleHeight: 1.0,\n    scaleZoom: [1, 10],\n    fitContentMargin: 10,\n    autoFitContent: false,\n    tooltipClassName: 'popover bottom',\n    countries: {\n      legend: false,\n      attr: {\n        fill: '#FCFCFC',\n        stroke: '#CCC',\n        'stroke-width': 0.5,\n      },\n      tooltipClassName: 'mt-map-tooltip popover bottom',\n    },\n    heatmap: {\n      mask: true,\n      weightByAttribute: null,\n      weightByAttributeScale: 'linear',\n      circles: {\n        min: 1,\n        max: 90,\n        step: 4,\n        color: '#FF0000',\n        colorStrength: 1,\n        blur: 4.0,\n      },\n      borders: {\n        stroke: 1,\n        opacity: 0.1,\n        color: '#000',\n      },\n    },\n    markers: {\n      attr: {\n        r: 4,\n        fill: 'blue',\n        stroke: '#CCC',\n        'stroke-width': 0.5,\n      },\n      tooltipClassName: 'mt-map-tooltip popover bottom',\n    },\n    title: {\n      fontSize: 12,\n      fontFamily: 'Helevetica, Arial, Sans-Serif',\n    },\n  },\n  filters: {\n    saveState: true,\n  },\n  table: {\n    className: 'table table-striped table-bordered',\n    collapseRowsBy: [],\n  },\n};\n","export default class Legend {\n  constructor(map) {\n    this.legendWidth = 220;\n    this.map = map;\n    // Create Legend\n    this.node = this.map.svg\n      .append('g')\n      .attr('id', 'mt-map-legend')\n      .attr('transform',\n        `translate(${(this.map.getWidth() - 350)}, ${(this.map.getHeight() - 60)})`);\n\n    this.buildIndice();\n  }\n\n  buildScale(domain) {\n    const legendGradient = this.node\n    .append('defs')\n    .append('linearGradient')\n      .attr('id', 'mt-map-legend-gradient')\n      .attr('x1', '0%')\n      .attr('y1', '0%')\n      .attr('x2', '100%')\n      .attr('y2', '0%');\n\n    if (this.map.options.countries.attr.fill.minNegative &&\n        this.map.options.countries.attr.fill.maxNegative ) {\n\n      // todo - maybe watch for domain[0] < 0 && domain[1] < 0? fall back to normal min & max?\n      let midPercentNegative = Math.round(((0 - domain[0])/(domain[1] - domain[0])) * 100);\n      let midPercentPositive = midPercentNegative + 1;\n\n      legendGradient.append('stop')\n          .attr('offset', '0%')\n          .attr('style', `stop-color:${this.map.options.countries.attr.fill.maxNegative};stop-opacity:1`);\n\n      legendGradient.append('stop')\n          .attr('offset', midPercentNegative + '%')\n          .attr('style', `stop-color:${this.map.options.countries.attr.fill.minNegative};stop-opacity:1`);\n      legendGradient.append('stop')\n          .attr('offset', midPercentPositive + '%')\n          .attr('style', `stop-color:${this.map.options.countries.attr.fill.min};stop-opacity:1`);\n    } else {\n      legendGradient.append('stop')\n          .attr('offset', '0%')\n          .attr('style', `stop-color:${this.map.options.countries.attr.fill.min};stop-opacity:1`);\n    }\n\n    legendGradient.append('stop')\n    .attr('offset', '100%')\n    .attr('style', `stop-color:${this.map.options.countries.attr.fill.max};stop-opacity:1`);\n\n    this.node.append('rect')\n      .attr('x', 40)\n      .attr('y', 0)\n      .attr('width', this.legendWidth)\n      .attr('height', 15)\n      .attr('fill', 'url(#mt-map-legend-gradient)');\n  }\n\n  buildIndice() {\n    const indice = this.node.append('g')\n    .attr('id', 'mt-map-legend-indice')\n    .attr('style', 'display:none')\n    .attr('transform', 'translate(36,15)');\n\n    indice.append('polygon')\n      .attr('points', '4.5 0 9 5 0 5')\n      .attr('fill', '#222222');\n\n    indice.append('text')\n      .attr('x', 4)\n      .attr('y', 13)\n      .attr('width', 10)\n      .attr('height', 10)\n      .attr('text-anchor', 'middle')\n      .attr('font-family', 'Arial')\n      .attr('font-size', '9')\n      .attr('stroke', '#FFFFF')\n      .attr('stroke-width', '1')\n      .attr('fill', '#222222')\n      .text('0');\n\n    this.node.append('text')\n      .attr('id', 'mt-map-legend-min')\n      .attr('x', 35)\n      .attr('y', 13)\n      .attr('width', 35)\n      .attr('height', 15)\n      .attr('text-anchor', 'end')\n      .attr('font-family', 'Arial')\n      .attr('font-size', '14')\n      .attr('stroke', '#FFFFF')\n      .attr('stroke-width', '3')\n      .attr('fill', '#222222')\n      .text('0');\n\n    this.node.append('text')\n      .attr('id', 'mt-map-legend-max')\n      .attr('y', 13)\n      .attr('x', 265)\n      .attr('width', 40)\n      .attr('height', 15)\n      .attr('text-anchor', 'start')\n      .attr('font-family', 'Arial')\n      .attr('font-size', '14')\n      .attr('stroke', '#FFFFF')\n      .attr('stroke-width', '3')\n      .attr('fill', '#222222')\n      .text('1');\n  }\n\n  updateExtents(domain) {\n    document.getElementById('mt-map-legend').style.opacity = (domain[0] === domain[1]) ? 0 : 1;\n    if (document.getElementById('mt-map-legend-min')) {\n      this.node.select('#mt-map-legend-min').text(Math.round(domain[0]));\n      this.node.select('#mt-map-legend-max').text(Math.round(domain[1]));\n\n      // pass in the min and max (domain) to the legend\n      this.buildScale(domain);\n    }\n  }\n\n  indiceChange(val) {\n    if (isNaN(val)) {\n      this.node.select('#mt-map-legend-indice')\n        .attr('style', 'display:none');\n    } else {\n      const maxValue = parseInt(this.node.select('#mt-map-legend-max').text(), 10);\n      const minValue = parseInt(this.node.select('#mt-map-legend-min').text(), 10);\n      let positionDelta = Math.round((0 - (minValue - val) /(maxValue - minValue)) * this.legendWidth);\n      this.node.select('#mt-map-legend-indice text').text(Math.round(val));\n      this.node.select('#mt-map-legend-indice')\n        .attr('style', 'display:block')\n        .attr('transform', `translate(${(36 + positionDelta)},15)`);\n    }\n  }\n}\n","export default class Legend {\n  constructor(map, options) {\n    this.map = map;\n    this.src = options.src;\n    this.position = options.position;\n    this.width = parseInt(options.width, 10);\n    this.height = parseInt(options.height, 10);\n    this.padding = options.padding || 10;\n    this.style = options.style;\n\n    if (!options.src) {\n      console.warn('Watermak src not found');\n      return;\n    }\n    if (isNaN(this.width)) {\n      console.warn('Watermak width not found');\n      return;\n    }\n    if (isNaN(this.height)) {\n      console.warn('Watermak height not found');\n      return;\n    }\n\n    if (window.btoa) {\n      this.buildWatermark();\n    } else {\n      console.warn('Watermark not rendered: btoa error');\n    }\n  }\n\n  buildWatermark() {\n    d3.xhr(this.src, res => {\n      let mapWatermarkDelta = 0;\n      if (this.map.options.title) mapWatermarkDelta = 30;\n      let mime;\n      let x;\n      let y;\n      if (this.src.indexOf('.svg') !== -1) {\n        mime = 'image/svg+xml';\n      } else if (this.src.indexOf('.jpg') !== -1 || this.src.indexOf('.jpeg') !== -1) {\n        mime = 'image/jpeg';\n      } else if (this.src.indexOf('.png') !== -1) {\n        mime = 'image/png';\n      } else {\n        console.warn('invalid watermark mime type');\n        return;\n      }\n      const dataUri = `data:${mime};base64,${window.btoa(res.responseText)}`;\n\n      if (this.position) {\n        const pos = this.position.split(' ');\n        if (pos[0] === 'top') {\n          y = this.padding;\n        } else if (pos[0] === 'middle') {\n          y = (this.map.getHeight() - this.height) / 2;\n        } else if (pos[0] === 'bottom') {\n          y = this.map.getHeight() - this.height - this.padding - mapWatermarkDelta;\n        } else {\n          console.warn('position should be (top|middle|bottom) (left|middle|right)');\n        }\n\n        if (pos[1] === 'left') {\n          x = this.padding;\n        } else if (pos[1] === 'middle') {\n          x = (this.map.getWidth() - this.width) / 2;\n        } else if (pos[1] === 'right') {\n          x = this.map.getWidth() - this.width - this.padding;\n        } else {\n          console.warn('position should be (top|middle|bottom) (left|middle|right)');\n        }\n      }\n\n      this.node = this.map.svg\n        .append('image')\n        .attr('xlink:href', dataUri)\n        .attr('width', this.width)\n        .attr('height', this.height);\n\n      if (x && y) {\n        this.node.attr('x', x).attr('y', y);\n      }\n\n      if (this.style) {\n        this.node.attr('style', this.style);\n      }\n    });\n  }\n}\n","/* eslint-disable */\n\n/*\n    StackBlur - a fast almost Gaussian Blur For Canvas\n    Version:     0.5\n    Author:        Mario Klingemann\n    Contact:     mario@quasimondo.com\n    Website:    http://www.quasimondo.com/StackBlurForCanvas\n    Twitter:    @quasimondo\n    In case you find this class useful - especially in commercial projects -\n    I am not totally unhappy for a small donation to my PayPal account\n    mario@quasimondo.de\n    Or support me on flattr:\n    https://flattr.com/thing/72791/StackBlur-a-fast-almost-Gaussian-Blur-Effect-for-CanvasJavascript\n    Copyright (c) 2010 Mario Klingemann\n    Permission is hereby granted, free of charge, to any person\n    obtaining a copy of this software and associated documentation\n    files (the \"Software\"), to deal in the Software without\n    restriction, including without limitation the rights to use,\n    copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the\n    Software is furnished to do so, subject to the following\n    conditions:\n    The above copyright notice and this permission notice shall be\n    included in all copies or substantial portions of the Software.\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n    OTHER DEALINGS IN THE SOFTWARE.\n    */\n\n\nvar mul_table = [\n    512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,\n    454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,\n    482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,\n    437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,\n    497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,\n    320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,\n    446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,\n    329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,\n    505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,\n    399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,\n    324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,\n    268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,\n    451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,\n    385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,\n    332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,\n    289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];\n\n\nvar shg_table = [\n    9, 11, 12, 13, 13, 14, 14, 15, 15, 15, 15, 16, 16, 16, 16, 17,\n    17, 17, 17, 17, 17, 17, 18, 18, 18, 18, 18, 18, 18, 18, 18, 19,\n    19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 20, 20, 20,\n    20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 21,\n    21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21,\n    21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 22, 22, 22, 22, 22, 22,\n    22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22,\n    22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 23,\n    23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23,\n    23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23,\n    23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23,\n    23, 23, 23, 23, 23, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n    24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n    24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n    24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24,\n    24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24 ];\n\n\nfunction processImage(img, canvas, radius, blurAlphaChannel)\n{\n    if (typeof(img) == 'string') {\n        var img = document.getElementById(img);\n    }\n    else if (typeof HTMLImageElement !== 'undefined' && !img instanceof HTMLImageElement) {\n        return;\n    }\n    var w = img.naturalWidth;\n    var h = img.naturalHeight;\n\n    if (typeof(canvas) == 'string') {\n        var canvas = document.getElementById(canvas);\n    }\n    else if (typeof HTMLCanvasElement !== 'undefined' && !canvas instanceof HTMLCanvasElement) {\n        return;\n    }\n\n    canvas.style.width  = w + 'px';\n    canvas.style.height = h + 'px';\n    canvas.width = w;\n    canvas.height = h;\n\n    var context = canvas.getContext('2d');\n    context.clearRect(0, 0, w, h);\n    context.drawImage(img, 0, 0);\n\n    if (isNaN(radius) || radius < 1) return;\n\n    if (blurAlphaChannel)\n        processCanvasRGBA(canvas, 0, 0, w, h, radius);\n    else\n        processCanvasRGB(canvas, 0, 0, w, h, radius);\n}\n\nfunction getImageDataFromCanvas(canvas, top_x, top_y, width, height)\n{\n    if (typeof(canvas) == 'string')\n        var canvas  = document.getElementById(canvas);\n    else if (typeof HTMLCanvasElement !== 'undefined' && !canvas instanceof HTMLCanvasElement)\n        return;\n\n    var context = canvas.getContext('2d');\n    var imageData;\n\n    try {\n        try {\n            imageData = context.getImageData(top_x, top_y, width, height);\n        } catch(e) {\n            throw new Error(\"unable to access local image data: \" + e);\n            return;\n        }\n    } catch(e) {\n        throw new Error(\"unable to access image data: \" + e);\n    }\n\n    return imageData;\n}\n\nfunction processCanvasRGBA(canvas, top_x, top_y, width, height, radius)\n{\n    if (isNaN(radius) || radius < 1) return;\n    radius |= 0;\n\n    var imageData = getImageDataFromCanvas(canvas, top_x, top_y, width, height);\n\n    imageData = processImageDataRGBA(imageData, top_x, top_y, width, height, radius);\n\n    canvas.getContext('2d').putImageData(imageData, top_x, top_y);\n}\n\nfunction processImageDataRGBA(imageData, top_x, top_y, width, height, radius)\n{\n    var pixels = imageData.data;\n\n    var x, y, i, p, yp, yi, yw, r_sum, g_sum, b_sum, a_sum,\n        r_out_sum, g_out_sum, b_out_sum, a_out_sum,\n        r_in_sum, g_in_sum, b_in_sum, a_in_sum,\n        pr, pg, pb, pa, rbs;\n\n    var div = radius + radius + 1;\n    var w4 = width << 2;\n    var widthMinus1  = width - 1;\n    var heightMinus1 = height - 1;\n    var radiusPlus1  = radius + 1;\n    var sumFactor = radiusPlus1 * (radiusPlus1 + 1) / 2;\n\n    var stackStart = new BlurStack();\n    var stack = stackStart;\n    for (i = 1; i < div; i++)\n    {\n        stack = stack.next = new BlurStack();\n        if (i == radiusPlus1) var stackEnd = stack;\n    }\n    stack.next = stackStart;\n    var stackIn = null;\n    var stackOut = null;\n\n    yw = yi = 0;\n\n    var mul_sum = mul_table[radius];\n    var shg_sum = shg_table[radius];\n\n    for (y = 0; y < height; y++)\n    {\n        r_in_sum = g_in_sum = b_in_sum = a_in_sum = r_sum = g_sum = b_sum = a_sum = 0;\n\n        r_out_sum = radiusPlus1 * (pr = pixels[yi]);\n        g_out_sum = radiusPlus1 * (pg = pixels[yi+1]);\n        b_out_sum = radiusPlus1 * (pb = pixels[yi+2]);\n        a_out_sum = radiusPlus1 * (pa = pixels[yi+3]);\n\n        r_sum += sumFactor * pr;\n        g_sum += sumFactor * pg;\n        b_sum += sumFactor * pb;\n        a_sum += sumFactor * pa;\n\n        stack = stackStart;\n\n        for (i = 0; i < radiusPlus1; i++)\n        {\n            stack.r = pr;\n            stack.g = pg;\n            stack.b = pb;\n            stack.a = pa;\n            stack = stack.next;\n        }\n\n        for (i = 1; i < radiusPlus1; i++)\n        {\n            p = yi + ((widthMinus1 < i ? widthMinus1 : i) << 2);\n            r_sum += (stack.r = (pr = pixels[p])) * (rbs = radiusPlus1 - i);\n            g_sum += (stack.g = (pg = pixels[p+1])) * rbs;\n            b_sum += (stack.b = (pb = pixels[p+2])) * rbs;\n            a_sum += (stack.a = (pa = pixels[p+3])) * rbs;\n\n            r_in_sum += pr;\n            g_in_sum += pg;\n            b_in_sum += pb;\n            a_in_sum += pa;\n\n            stack = stack.next;\n        }\n\n\n        stackIn = stackStart;\n        stackOut = stackEnd;\n        for (x = 0; x < width; x++)\n        {\n            pixels[yi+3] = pa = (a_sum * mul_sum) >> shg_sum;\n            if (pa != 0)\n            {\n                pa = 255 / pa;\n                pixels[yi]   = ((r_sum * mul_sum) >> shg_sum) * pa;\n                pixels[yi+1] = ((g_sum * mul_sum) >> shg_sum) * pa;\n                pixels[yi+2] = ((b_sum * mul_sum) >> shg_sum) * pa;\n            } else {\n                pixels[yi] = pixels[yi+1] = pixels[yi+2] = 0;\n            }\n\n            r_sum -= r_out_sum;\n            g_sum -= g_out_sum;\n            b_sum -= b_out_sum;\n            a_sum -= a_out_sum;\n\n            r_out_sum -= stackIn.r;\n            g_out_sum -= stackIn.g;\n            b_out_sum -= stackIn.b;\n            a_out_sum -= stackIn.a;\n\n            p =  (yw + ((p = x + radius + 1) < widthMinus1 ? p : widthMinus1)) << 2;\n\n            r_in_sum += (stackIn.r = pixels[p]);\n            g_in_sum += (stackIn.g = pixels[p+1]);\n            b_in_sum += (stackIn.b = pixels[p+2]);\n            a_in_sum += (stackIn.a = pixels[p+3]);\n\n            r_sum += r_in_sum;\n            g_sum += g_in_sum;\n            b_sum += b_in_sum;\n            a_sum += a_in_sum;\n\n            stackIn = stackIn.next;\n\n            r_out_sum += (pr = stackOut.r);\n            g_out_sum += (pg = stackOut.g);\n            b_out_sum += (pb = stackOut.b);\n            a_out_sum += (pa = stackOut.a);\n\n            r_in_sum -= pr;\n            g_in_sum -= pg;\n            b_in_sum -= pb;\n            a_in_sum -= pa;\n\n            stackOut = stackOut.next;\n\n            yi += 4;\n        }\n        yw += width;\n    }\n\n\n    for (x = 0; x < width; x++)\n    {\n        g_in_sum = b_in_sum = a_in_sum = r_in_sum = g_sum = b_sum = a_sum = r_sum = 0;\n\n        yi = x << 2;\n        r_out_sum = radiusPlus1 * (pr = pixels[yi]);\n        g_out_sum = radiusPlus1 * (pg = pixels[yi+1]);\n        b_out_sum = radiusPlus1 * (pb = pixels[yi+2]);\n        a_out_sum = radiusPlus1 * (pa = pixels[yi+3]);\n\n        r_sum += sumFactor * pr;\n        g_sum += sumFactor * pg;\n        b_sum += sumFactor * pb;\n        a_sum += sumFactor * pa;\n\n        stack = stackStart;\n\n        for (i = 0; i < radiusPlus1; i++)\n        {\n            stack.r = pr;\n            stack.g = pg;\n            stack.b = pb;\n            stack.a = pa;\n            stack = stack.next;\n        }\n\n        yp = width;\n\n        for (i = 1; i <= radius; i++)\n        {\n            yi = (yp + x) << 2;\n\n            r_sum += (stack.r = (pr = pixels[yi])) * (rbs = radiusPlus1 - i);\n            g_sum += (stack.g = (pg = pixels[yi+1])) * rbs;\n            b_sum += (stack.b = (pb = pixels[yi+2])) * rbs;\n            a_sum += (stack.a = (pa = pixels[yi+3])) * rbs;\n\n            r_in_sum += pr;\n            g_in_sum += pg;\n            b_in_sum += pb;\n            a_in_sum += pa;\n\n            stack = stack.next;\n\n            if(i < heightMinus1)\n            {\n                yp += width;\n            }\n        }\n\n        yi = x;\n        stackIn = stackStart;\n        stackOut = stackEnd;\n        for (y = 0; y < height; y++)\n        {\n            p = yi << 2;\n            pixels[p+3] = pa = (a_sum * mul_sum) >> shg_sum;\n            if (pa > 0)\n            {\n                pa = 255 / pa;\n                pixels[p]   = ((r_sum * mul_sum) >> shg_sum) * pa;\n                pixels[p+1] = ((g_sum * mul_sum) >> shg_sum) * pa;\n                pixels[p+2] = ((b_sum * mul_sum) >> shg_sum) * pa;\n            } else {\n                pixels[p] = pixels[p+1] = pixels[p+2] = 0;\n            }\n\n            r_sum -= r_out_sum;\n            g_sum -= g_out_sum;\n            b_sum -= b_out_sum;\n            a_sum -= a_out_sum;\n\n            r_out_sum -= stackIn.r;\n            g_out_sum -= stackIn.g;\n            b_out_sum -= stackIn.b;\n            a_out_sum -= stackIn.a;\n\n            p = (x + (((p = y + radiusPlus1) < heightMinus1 ? p : heightMinus1) * width)) << 2;\n\n            r_sum += (r_in_sum += (stackIn.r = pixels[p]));\n            g_sum += (g_in_sum += (stackIn.g = pixels[p+1]));\n            b_sum += (b_in_sum += (stackIn.b = pixels[p+2]));\n            a_sum += (a_in_sum += (stackIn.a = pixels[p+3]));\n\n            stackIn = stackIn.next;\n\n            r_out_sum += (pr = stackOut.r);\n            g_out_sum += (pg = stackOut.g);\n            b_out_sum += (pb = stackOut.b);\n            a_out_sum += (pa = stackOut.a);\n\n            r_in_sum -= pr;\n            g_in_sum -= pg;\n            b_in_sum -= pb;\n            a_in_sum -= pa;\n\n            stackOut = stackOut.next;\n\n            yi += width;\n        }\n    }\n    return imageData;\n}\n\nfunction processCanvasRGB(canvas, top_x, top_y, width, height, radius)\n{\n    if (isNaN(radius) || radius < 1) return;\n    radius |= 0;\n\n    var imageData = getImageDataFromCanvas(canvas, top_x, top_y, width, height);\n    imageData = processImageDataRGB(imageData, top_x, top_y, width, height, radius);\n\n    canvas.getContext('2d').putImageData(imageData, top_x, top_y);\n}\n\nfunction processImageDataRGB(imageData, top_x, top_y, width, height, radius)\n{\n    var pixels = imageData.data;\n\n    var x, y, i, p, yp, yi, yw, r_sum, g_sum, b_sum,\n        r_out_sum, g_out_sum, b_out_sum,\n        r_in_sum, g_in_sum, b_in_sum,\n        pr, pg, pb, rbs;\n\n    var div = radius + radius + 1;\n    var w4 = width << 2;\n    var widthMinus1  = width - 1;\n    var heightMinus1 = height - 1;\n    var radiusPlus1  = radius + 1;\n    var sumFactor = radiusPlus1 * (radiusPlus1 + 1) / 2;\n\n    var stackStart = new BlurStack();\n    var stack = stackStart;\n    for (i = 1; i < div; i++)\n    {\n        stack = stack.next = new BlurStack();\n        if (i == radiusPlus1) var stackEnd = stack;\n    }\n    stack.next = stackStart;\n    var stackIn = null;\n    var stackOut = null;\n\n    yw = yi = 0;\n\n    var mul_sum = mul_table[radius];\n    var shg_sum = shg_table[radius];\n\n    for (y = 0; y < height; y++)\n    {\n        r_in_sum = g_in_sum = b_in_sum = r_sum = g_sum = b_sum = 0;\n\n        r_out_sum = radiusPlus1 * (pr = pixels[yi]);\n        g_out_sum = radiusPlus1 * (pg = pixels[yi+1]);\n        b_out_sum = radiusPlus1 * (pb = pixels[yi+2]);\n\n        r_sum += sumFactor * pr;\n        g_sum += sumFactor * pg;\n        b_sum += sumFactor * pb;\n\n        stack = stackStart;\n\n        for (i = 0; i < radiusPlus1; i++)\n        {\n            stack.r = pr;\n            stack.g = pg;\n            stack.b = pb;\n            stack = stack.next;\n        }\n\n        for (i = 1; i < radiusPlus1; i++)\n        {\n            p = yi + ((widthMinus1 < i ? widthMinus1 : i) << 2);\n            r_sum += (stack.r = (pr = pixels[p])) * (rbs = radiusPlus1 - i);\n            g_sum += (stack.g = (pg = pixels[p+1])) * rbs;\n            b_sum += (stack.b = (pb = pixels[p+2])) * rbs;\n\n            r_in_sum += pr;\n            g_in_sum += pg;\n            b_in_sum += pb;\n\n            stack = stack.next;\n        }\n\n\n        stackIn = stackStart;\n        stackOut = stackEnd;\n        for (x = 0; x < width; x++)\n        {\n            pixels[yi]   = (r_sum * mul_sum) >> shg_sum;\n            pixels[yi+1] = (g_sum * mul_sum) >> shg_sum;\n            pixels[yi+2] = (b_sum * mul_sum) >> shg_sum;\n\n            r_sum -= r_out_sum;\n            g_sum -= g_out_sum;\n            b_sum -= b_out_sum;\n\n            r_out_sum -= stackIn.r;\n            g_out_sum -= stackIn.g;\n            b_out_sum -= stackIn.b;\n\n            p =  (yw + ((p = x + radius + 1) < widthMinus1 ? p : widthMinus1)) << 2;\n\n            r_in_sum += (stackIn.r = pixels[p]);\n            g_in_sum += (stackIn.g = pixels[p+1]);\n            b_in_sum += (stackIn.b = pixels[p+2]);\n\n            r_sum += r_in_sum;\n            g_sum += g_in_sum;\n            b_sum += b_in_sum;\n\n            stackIn = stackIn.next;\n\n            r_out_sum += (pr = stackOut.r);\n            g_out_sum += (pg = stackOut.g);\n            b_out_sum += (pb = stackOut.b);\n\n            r_in_sum -= pr;\n            g_in_sum -= pg;\n            b_in_sum -= pb;\n\n            stackOut = stackOut.next;\n\n            yi += 4;\n        }\n        yw += width;\n    }\n\n\n    for (x = 0; x < width; x++)\n    {\n        g_in_sum = b_in_sum = r_in_sum = g_sum = b_sum = r_sum = 0;\n\n        yi = x << 2;\n        r_out_sum = radiusPlus1 * (pr = pixels[yi]);\n        g_out_sum = radiusPlus1 * (pg = pixels[yi+1]);\n        b_out_sum = radiusPlus1 * (pb = pixels[yi+2]);\n\n        r_sum += sumFactor * pr;\n        g_sum += sumFactor * pg;\n        b_sum += sumFactor * pb;\n\n        stack = stackStart;\n\n        for (i = 0; i < radiusPlus1; i++)\n        {\n            stack.r = pr;\n            stack.g = pg;\n            stack.b = pb;\n            stack = stack.next;\n        }\n\n        yp = width;\n\n        for (i = 1; i <= radius; i++)\n        {\n            yi = (yp + x) << 2;\n\n            r_sum += (stack.r = (pr = pixels[yi])) * (rbs = radiusPlus1 - i);\n            g_sum += (stack.g = (pg = pixels[yi+1])) * rbs;\n            b_sum += (stack.b = (pb = pixels[yi+2])) * rbs;\n\n            r_in_sum += pr;\n            g_in_sum += pg;\n            b_in_sum += pb;\n\n            stack = stack.next;\n\n            if(i < heightMinus1)\n            {\n                yp += width;\n            }\n        }\n\n        yi = x;\n        stackIn = stackStart;\n        stackOut = stackEnd;\n        for (y = 0; y < height; y++)\n        {\n            p = yi << 2;\n            pixels[p]   = (r_sum * mul_sum) >> shg_sum;\n            pixels[p+1] = (g_sum * mul_sum) >> shg_sum;\n            pixels[p+2] = (b_sum * mul_sum) >> shg_sum;\n\n            r_sum -= r_out_sum;\n            g_sum -= g_out_sum;\n            b_sum -= b_out_sum;\n\n            r_out_sum -= stackIn.r;\n            g_out_sum -= stackIn.g;\n            b_out_sum -= stackIn.b;\n\n            p = (x + (((p = y + radiusPlus1) < heightMinus1 ? p : heightMinus1) * width)) << 2;\n\n            r_sum += (r_in_sum += (stackIn.r = pixels[p]));\n            g_sum += (g_in_sum += (stackIn.g = pixels[p+1]));\n            b_sum += (b_in_sum += (stackIn.b = pixels[p+2]));\n\n            stackIn = stackIn.next;\n\n            r_out_sum += (pr = stackOut.r);\n            g_out_sum += (pg = stackOut.g);\n            b_out_sum += (pb = stackOut.b);\n\n            r_in_sum -= pr;\n            g_in_sum -= pg;\n            b_in_sum -= pb;\n\n            stackOut = stackOut.next;\n\n            yi += width;\n        }\n    }\n\n    return imageData;\n}\n\nfunction BlurStack()\n{\n    this.r = 0;\n    this.g = 0;\n    this.b = 0;\n    this.a = 0;\n    this.next = null;\n}\n\nexport default {\n    image: processImage,\n    canvasRGBA: processCanvasRGBA,\n    canvasRGB: processCanvasRGB,\n    imageDataRGBA: processImageDataRGBA,\n    imageDataRGB: processImageDataRGB\n};\n","import Legend from './Legend';\nimport Watermark from './Watermark';\nimport StackBlur from './StackBlur';\n/**\n * Used the name GeoMap instead of Map to avoid collision with the native Map class of JS\n */\nexport default class GeoMap {\n  /**\n   * Geo Mapping class constructor that will initiate the map drawing\n   * @param maptable: Maptable main Object\n   * @param options: options communicated to map\n   * @param jsonWorld: Object that contain TopoJSON dataset\n   */\n  constructor(maptable, options, jsonWorld) {\n    const self = this;\n    this.maptable = maptable;\n    this.scale = 1;\n    this.transX = 0;\n    this.transY = 0;\n\n    this.options = options;\n\n    this.jsonWorld = jsonWorld;\n\n    this.containerSelector = maptable.options.target;\n    this.container = document.querySelector(maptable.options.target);\n\n    this.node = this.container.querySelector('#mt-map');\n    if (!this.node) {\n      // Map wrapper\n      const mapWrapper = this.container.querySelector('.mt-map-container');\n\n      // Map\n      this.node = document.createElement('div');\n      this.node.setAttribute('id', 'mt-map');\n      mapWrapper.appendChild(this.node);\n    }\n\n    this.svg = d3.select(this.node)\n      .append('svg')\n      .attr('id', 'mt-map-svg')\n      .attr('xmlns', 'http://www.w3.org/2000/svg')\n      .attr('xmlns:xlink', 'http://www.w3.org/1999/xlink')\n      .attr('viewBox', `0 0 ${this.getWidth()} ${this.getHeight()}`)\n      .attr('width', this.getWidth())\n      .attr('height', this.getHeight());\n\n    this.projection = d3.geo.equirectangular()\n      .translate([this.getWidth() / 2, this.getHeight() / (2 * this.options.scaleHeight)])\n      .scale((this.getWidth() / 640) * 100)\n      .rotate([-12, 0])\n      .precision(0.1);\n\n    this.path = d3.geo.path().projection(this.projection);\n\n    // Add coordinates to rawData\n    this.maptable.rawData.forEach(d => {\n      d.longitude = parseFloat(d[self.options.longitudeKey]);\n      d.latitude = parseFloat(d[self.options.latitudeKey]);\n      let coord = [0, 0];\n      if (!isNaN(d.longitude) && !isNaN(d.latitude)) {\n        coord = self.projection([d.longitude, d.latitude]);\n      }\n      d.x = coord[0];\n      d.y = coord[1];\n    });\n\n    this.zoomListener = d3.behavior\n      .zoom()\n      .scaleExtent(this.options.scaleZoom)\n      .on('zoom', this.rescale.bind(this));\n\n    // Attach Zoom event to map\n    if (this.options.zoom) {\n      this.svg = this.svg.call(this.zoomListener.bind(this));\n    }\n\n    // Add tooltip\n    if (this.options.markers) {\n      this.tooltipMarkersNode = d3.select(this.node)\n        .append('div')\n        .attr('id', 'mt-map-markers-tooltip')\n        .attr('class', `mt-map-tooltip ${this.options.markers.tooltipClassName}`)\n        .style('display', 'none');\n    }\n\n    if (this.options.countries) {\n      this.tooltipCountriesNode = d3.select(this.node)\n        .append('div')\n        .attr('id', 'mt-map-countries-tooltip')\n        .attr('class', `mt-map-tooltip ${this.options.countries.tooltipClassName}`)\n        .style('display', 'none');\n    }\n\n    this.layerGlobal = this.svg.append('g').attr('class', 'mt-map-global');\n    this.layerCountries = this.layerGlobal.append('g').attr('class', 'mt-map-countries');\n    this.layerHeatmap = this.layerGlobal.append('g').attr('class', 'mt-map-heatmap');\n    this.layerMarkers = this.layerGlobal.append('g').attr('class', 'mt-map-markers');\n\n    // Add Watermark\n    if (this.options.watermark) {\n      this.watermark = new Watermark(this, this.options.watermark);\n    }\n\n    // Add Title\n    if (this.options.title) {\n      this.buildTitle();\n    }\n\n    // Add Export SVG Capability\n    if (this.options.exportSvgClient || this.options.exportSvg) {\n      this.addExportSvgCapability();\n    }\n\n    // AutoResize\n    if (!this.options.width) {\n      window.addEventListener('resize', () => {\n        this.svg.attr('width', this.getWidth());\n        this.svg.attr('height', this.getHeight());\n        this.rescale();\n      });\n    }\n\n    // Let's build things\n    this.loadGeometries();\n\n    // On complete\n    if (this.options.onComplete && this.options.onComplete.constructor === Function) {\n      this.options.onComplete.bind(this.maptable)();\n    }\n  }\n\n  scaleAttributes() {\n    return Math.pow(this.scale, 2 / 3);\n  }\n\n  getWidth() {\n    if (this.options.width) {\n      return this.options.width;\n    }\n    return this.node.offsetWidth;\n  }\n\n  getHeight() {\n    const deltaHeight = (this.options.title) ? 30 : 0;\n    if (!this.options.height && this.options.ratioFromWidth) {\n      return this.getWidth() * this.options.ratioFromWidth * this.options.scaleHeight + deltaHeight;\n    }\n    return this.options.height * this.options.scaleHeight + deltaHeight;\n  }\n\n  /**\n   * Load geometries and built the map components\n   */\n  loadGeometries() {\n    // We filter world data\n    if (this.options.filterCountries) {\n      this.jsonWorld.objects.countries.geometries = this.jsonWorld.objects.countries\n        .geometries.filter(this.options.filterCountries);\n    }\n\n    // Build countries\n    if (this.options.countries) this.buildCountries();\n\n    // Build heatmap\n    if (this.options.heatmap) this.buildHeatmap();\n  }\n\n  /**\n   * Logic to build the heatmap elements (without the filling the heatmap image)\n   */\n  buildHeatmap() {\n    // Build vectors\n    const lands = topojson.merge(this.jsonWorld, this.jsonWorld.objects.countries.geometries);\n    if (!this.options.heatmap.disableMask) {\n      this.maskHeatmap = this.layerHeatmap.append('defs')\n        .append('clipPath')\n        .attr('id', 'mt-map-heatmap-mask');\n\n      this.maskHeatmap\n          .datum(lands)\n          .append('path')\n          .attr('class', 'mt-map-heatmap-mask-paths')\n          .attr('d', this.path);\n    }\n\n    this.imgHeatmap = this.layerHeatmap\n      .append('image')\n      .attr('width', this.getWidth())\n      .attr('height', this.getHeight())\n      .attr('x', 0)\n      .attr('y', 0)\n      .attr('class', 'mt-map-heatmap-img');\n\n    if (this.options.heatmap.mask) {\n      this.imgHeatmap = this.imgHeatmap.attr('clip-path', 'url(#mt-map-heatmap-mask)');\n    }\n\n    if (this.options.heatmap.borders) {\n      const borders = topojson.mesh(this.jsonWorld,\n        this.jsonWorld.objects.countries, (a, b) => a !== b);\n\n      this.bordersHeatmap = this.layerHeatmap\n          .append('g')\n          .attr('class', 'mt-map-heatmap-borders');\n\n      this.bordersHeatmap.selectAll('path.mt-map-heatmap-borders-paths')\n        .data([lands, borders])\n        .enter()\n        .append('path')\n        .attr('class', 'mt-map-heatmap-borders-paths')\n        .attr('fill', 'none')\n        .attr('stroke-width', this.options.heatmap.borders.stroke)\n        .attr('stroke', this.options.heatmap.borders.color)\n        .attr('style', `opacity: ${this.options.heatmap.borders.opacity}`)\n        .attr('d', this.path);\n    }\n  }\n\n  /**\n   * Get Scale for every circle magnitude\n   * @param heatmapDataset: heatmap dataset that we use\n   * @returns scale: function - Scale function that output a value [0 - 1]\n   */\n  getMagnitudeScale(heatmapDataset) {\n    const opts = this.options.heatmap;\n    const lengthDataset = heatmapDataset.length;\n    if (!lengthDataset) return () => 0;\n    // const layersPerLocation = (opts.circles.max - opts.circles.min) / opts.circles.step;\n    const maxOpacityScale = d3.scale.linear()\n      .domain([1, lengthDataset])\n      .range([1, 0.25]);\n    const centralCircleOpacity = maxOpacityScale(lengthDataset);\n\n    const scale = d3.scale.linear()\n      .domain([opts.circles.min, 20])\n      .range([centralCircleOpacity, 0]);\n    return (m) => scale(m);\n  }\n\n  /**\n   * Get Scale for every data point (used for weighting)\n   * @returns scale: function - Scale function that output a value [0 - 1]\n   */\n  getDatumScale() {\n    if (!this.options.heatmap.weightByAttribute) return () => 1;\n    const dataExtents = d3.extent(this.maptable.data, this.options.heatmap.weightByAttribute);\n    const userScale = (this.options.heatmap.weightByAttributeScale === 'log') ?\n      d3.scale.log : d3.scale.linear;\n    const scale = userScale().domain(dataExtents).range([0.5, 1]);\n    return (d) => {\n      const val = this.options.heatmap.weightByAttribute(d);\n      if (!val) return 0;\n      return scale(val);\n    };\n  }\n\n  /**\n   * Get the Data URL of the heatmap image\n   * @returns {string} base64 image\n   */\n  getHeatmapData() {\n    const canvasHeatmap = d3.select(this.node)\n      .append('canvas')\n      .attr('id', 'mt-map-heatmap-canvas')\n      .attr('width', this.getWidth())\n      .attr('height', this.getHeight())\n      .attr('style', 'display: none;');\n\n    const ctx = canvasHeatmap.node().getContext('2d');\n    ctx.globalCompositeOperation = 'multiply';\n    const circles = d3.range(\n      this.options.heatmap.circles.min,\n      this.options.heatmap.circles.max,\n      this.options.heatmap.circles.step\n    );\n    const datumScale = this.getDatumScale();\n    const heatmapDataset = this.maptable.data.filter(d => {\n      return datumScale(d) > 0.1;\n    });\n    const path = this.path.context(ctx);\n    const magnitudeScale = this.getMagnitudeScale(heatmapDataset);\n    const colorScale = d3.scale.linear()\n      .domain([1, 0])\n      .range(['#000000', '#FFFFFF']);\n\n    // Make a flat white background first\n    ctx.beginPath();\n    ctx.rect(0, 0, this.getWidth(), this.getHeight());\n    ctx.fillStyle = '#ffffff';\n    ctx.fill();\n    ctx.closePath();\n\n    // color strenght factor\n    const colorMultiplier = (x) => {\n      const a = this.options.heatmap.circles.colorStrength;\n      const aa = 1 + ((a - 1) / 100);\n      if (a > 1) return (2 - aa) * x + aa - 1;\n      return a * x;\n    };\n\n    // add condensed clouds\n    heatmapDataset.forEach((point) => {\n      const scaleOpacityDatum = datumScale(point);\n      circles.forEach(m => {\n        const opacity = colorMultiplier(magnitudeScale(m) * scaleOpacityDatum);\n        if (opacity > 0) {\n          ctx.beginPath();\n          path(d3.geo.circle().origin([point.longitude, point.latitude]).angle(m - 0.0001)());\n          ctx.fillStyle = colorScale(opacity);\n          ctx.fill();\n          ctx.closePath();\n        }\n      });\n    });\n\n    StackBlur.canvasRGBA(canvasHeatmap.node(), 0, 0, this.getWidth(),\n      this.getHeight(), this.options.heatmap.circles.blur);\n\n    // Add color layer\n    ctx.beginPath();\n    ctx.globalCompositeOperation = 'screen';\n    ctx.rect(0, 0, this.getWidth(), this.getHeight());\n    ctx.fillStyle = this.options.heatmap.circles.color;\n    ctx.fill();\n    ctx.closePath();\n\n    const dataUrl = canvasHeatmap.node().toDataURL();\n    canvasHeatmap.remove();\n    return dataUrl;\n  }\n\n  /**\n   * Set the data URL to the heatmap image\n   */\n  updateHeatmap() {\n    const dataUrl = this.getHeatmapData();\n    this.imgHeatmap.attr('xlink:href', dataUrl);\n  }\n\n  /**\n   * build the paths for the countries\n   */\n  buildCountries() {\n    this.dataCountries = topojson.feature(this.jsonWorld,\n      this.jsonWorld.objects.countries).features;\n\n    // Build country paths\n    this.layerCountries\n      .selectAll('.mt-map-country')\n        .data(this.dataCountries)\n        .enter()\n        .insert('path')\n        .attr('class', 'mt-map-country')\n        .attr('d', this.path);\n\n    // Build Country Legend\n    this.legendCountry = {};\n\n    if (this.options.countries.attr.fill &&\n        this.options.countries.attr.fill.legend &&\n        this.options.countries.attr.fill.min &&\n        this.options.countries.attr.fill.max) {\n      this.legendCountry.fill = new Legend(this);\n    }\n  }\n\n  /**\n   * Set the right color for every country\n   */\n  updateCountries() {\n    // Data from user input\n    const dataByCountry = d3.nest()\n          .key(d => d[this.options.countryIdentifierKey])\n          .entries(this.maptable.data);\n\n    // We merge both data\n    this.dataCountries.forEach(geoDatum => {\n      geoDatum.key = geoDatum.properties[this.options.countryIdentifierType];\n      const matchedCountry = dataByCountry.filter(uDatum => {\n        return uDatum.key === geoDatum.key;\n      });\n      geoDatum.values = (matchedCountry.length === 0) ? [] : matchedCountry[0].values;\n      geoDatum.attr = {};\n      geoDatum.rollupValue = {};\n    });\n\n    // We calculate attributes values\n    Object.keys(this.options.countries.attr).forEach(k => {\n      this.setAttrValues(k, this.options.countries.attr[k], this.dataCountries);\n    });\n\n    // Update SVG\n    const countryItem = d3.selectAll('.mt-map-country').each(function (d) {\n      const targetPath = this;\n      Object.keys(d.attr).forEach(key => {\n        d3.select(targetPath).attr(key, d.attr[key]);\n      });\n    });\n\n    // Update Legend\n    Object.keys(this.options.countries.attr).forEach(attrKey => {\n      const attrValue = this.options.countries.attr[attrKey];\n      if (typeof (attrValue) === 'object' && attrValue.legend) {\n        const scaleDomain = d3.extent(this.dataCountries, d => Number(d.rollupValue[attrKey]));\n        this.legendCountry[attrKey].updateExtents(scaleDomain);\n\n        // When we mouseover the legend, it should highlight the indice selected\n        countryItem.on('mouseover', (d) => {\n          this.legendCountry[attrKey].indiceChange(d.rollupValue[attrKey]);\n        })\n        .on('mouseout', () => {\n          this.legendCountry[attrKey].indiceChange(NaN);\n        });\n      }\n    });\n\n    // Update Tooltip\n    if (this.options.countries && this.options.countries.tooltip) {\n      this.activateTooltip(countryItem, this.tooltipCountriesNode, this.options.countries.tooltip);\n    }\n  }\n\n  updateMarkers() {\n    const defaultGroupBy = a => `${a.longitude},${a.latitude}`;\n\n    this.dataMarkers = d3.nest()\n      .key(defaultGroupBy)\n      .entries(this.maptable.data)\n      .filter(d => {\n        return d.values[0].x !== 0;\n      });\n\n    // We merge both data\n    this.dataMarkers.forEach(d => {\n      d.attr = {};\n      d.rollupValue = {};\n    });\n\n    // We calculate attributes values\n    Object.keys(this.options.markers.attr).forEach(k => {\n      this.setAttrValues(k, this.options.markers.attr[k], this.dataMarkers);\n    });\n\n    // Enter\n    const markerItem = this.layerMarkers\n      .selectAll('.mt-map-marker')\n      .data(this.dataMarkers);\n    let markerObject = markerItem.enter();\n    if (this.options.markers.customTag) {\n      markerObject = this.options.markers.customTag(markerObject);\n    } else {\n      markerObject = markerObject.append('svg:circle');\n    }\n    const markerClassName = (this.options.markers.className) ?\n      this.options.markers.className : '';\n\n    markerObject.attr('class', `mt-map-marker ${markerClassName}`);\n\n    // Exit\n    markerItem.exit().transition()\n      .attr('r', 0)\n      .attr('fill', '#eee')\n      .style('opacity', 0)\n      .remove();\n\n    // Update\n    const attrX = (this.options.markers.attrX) ? this.options.markers.attrX : 'cx';\n    const attrY = (this.options.markers.attrY) ? this.options.markers.attrY : 'cy';\n\n    const attrXDelta = (this.options.markers.attrXDelta) ? this.options.markers.attrXDelta : 0;\n    const attrYDelta = (this.options.markers.attrYDelta) ? this.options.markers.attrYDelta : 0;\n\n    const markerUpdate = markerItem\n      .attr(attrX, d => d.values[0].x + attrXDelta)\n      .attr(attrY, d => d.values[0].y + attrYDelta);\n\n    d3.selectAll(`${this.containerSelector} .mt-map-marker`).each(function (d) {\n      const targetPath = this;\n      Object.keys(d.attr).forEach(key => {\n        d3.select(targetPath).attr(key, d.attr[key]);\n      });\n    });\n\n    if (this.options.markers.tooltip) {\n      this.activateTooltip(markerUpdate, this.tooltipMarkersNode, this.options.markers.tooltip);\n    }\n\n    this.rescale();\n  }\n\n  fitContent() {\n    if (this.maptable.data.length === 0) {\n      this.transX = 0;\n      this.transY = 0;\n      this.scale = 1;\n      this.zoomListener.translate([this.transX, this.transY])\n        .scale(this.scale);\n      return;\n    }\n    const hor = d3.extent(this.maptable.data, d => d.x);\n    const ver = d3.extent(this.maptable.data, d => d.y);\n\n    // center dots with the good ratio\n    const ratio = this.getWidth() / this.getHeight();\n    const deltaMarker = 20 + ((this.options.title) ? 30 : 0);\n\n    const currentWidth = (hor[1] - hor[0]) + deltaMarker;\n    const currentHeight = (ver[1] - ver[0]) + deltaMarker;\n\n    const realHeight = currentWidth / ratio;\n    const realWidth = currentHeight * ratio;\n\n    let diffMarginWidth = 0;\n    let diffMarginHeight = 0;\n    if (realWidth >= currentWidth) {\n      diffMarginWidth = (realWidth - currentWidth) / 2;\n    } else {\n      diffMarginHeight = (realHeight - currentHeight) / 2;\n    }\n\n    // add layout margin\n    hor[0] -= (this.options.fitContentMargin + diffMarginWidth);\n    hor[1] += (this.options.fitContentMargin + diffMarginWidth);\n    ver[0] -= (this.options.fitContentMargin + diffMarginHeight);\n    ver[1] += (this.options.fitContentMargin + diffMarginHeight);\n\n    this.scale = this.getWidth() / (hor[1] - hor[0]);\n    this.transX = -1 * hor[0] * this.scale;\n    this.transY = -1 * ver[0] * this.scale;\n\n    this.zoomListener.translate([this.transX, this.transY]).scale(this.scale);\n  }\n\n  buildTitle() {\n    const titleContainer = this.svg\n      .append('svg')\n      .attr('width', this.getWidth())\n      .attr('x', 0)\n      .attr('y', (this.getHeight() - 30))\n      .attr('height', 30);\n\n    if (this.options.title.bgColor) {\n      titleContainer.append('rect')\n        .attr('x', 0)\n        .attr('y', 0)\n        .attr('width', this.getWidth())\n        .attr('height', 30)\n        .attr('fill', this.options.title.bgColor);\n    }\n\n    titleContainer.append('text')\n      .attr('id', 'mt-map-title')\n      .attr('x', 20)\n      .attr('font-size', this.options.title.fontSize)\n      .attr('font-family', this.options.title.fontFamily)\n      .attr('y', 20);\n\n    if (this.options.title.source) {\n      titleContainer.append('text')\n        .attr('y', 20)\n        .attr('x', (this.getWidth() - 20))\n        .attr('text-anchor', 'end')\n        .attr('font-size', this.options.title.fontSize)\n        .attr('font-family', this.options.title.fontFamily)\n        .html(this.options.title.source());\n    }\n  }\n\n  /**\n   * We encode a transaltion to be independent from the dimensions of the visualization\n   * @param originalTranslation: Array - original translation value (from screen)\n   * @returns encodedTranslation: Array - encoded translation\n   */\n  encodeTranslation(originalTranslation) {\n    const newTx = originalTranslation[0] / (this.scale * this.getWidth());\n\n    const newTy = originalTranslation[1] / (this.scale * this.getHeight());\n\n    return [newTx, newTy];\n  }\n\n  /**\n   * We decode a translation to adapt it to the dimensions of the visualization\n   * @param encodedTranslation: Array - encoded translation\n   * @returns originalTranslation: Array - original translation value (from screen)\n   */\n  decodeTranslation(encodedTranslation) {\n    const newTx = encodedTranslation[0] * this.getWidth() * this.scale;\n\n    const newTy = encodedTranslation[1] * this.getHeight() * this.scale;\n\n    return [newTx, newTy];\n  }\n\n  /**\n   * Restore state from the url hash\n   */\n  restoreState() {\n    const params = document.location.href.replace(/%21mt/g, '!mt').split('!mt-zoom=');\n    const defaultZoomRaw = (params[1]) ? params[1].split('!mt')[0] : null;\n    if (defaultZoomRaw) {\n      try {\n        const defaultZoom = JSON.parse(decodeURIComponent(defaultZoomRaw));\n        if (defaultZoom && defaultZoom.length === 3) {\n          this.scale = defaultZoom[0];\n          const originalTranslation = this.decodeTranslation([defaultZoom[1], defaultZoom[2]]);\n          this.transX = originalTranslation[0];\n          this.transY = originalTranslation[1];\n          this.zoomListener.scale(defaultZoom[0])\n          .translate(originalTranslation)\n          .event(this.svg);\n        }\n      } catch (e) {\n        console.log(`Maptable: Invalid URL State for mt-zoom ${e.message}`);\n      }\n    }\n  }\n\n  /**\n   * Save state into the url hash\n   */\n  saveState() {\n    const encodedTranslation = this.encodeTranslation([this.transX, this.transY]);\n    const exportedData = [this.scale, encodedTranslation[0],\n      encodedTranslation[1]];\n    if (exportedData[0] !== 1 && exportedData[1] !== 0 && exportedData[2] !== 0) {\n      this.maptable.saveState('zoom', exportedData);\n    }\n  }\n\n  rescale() {\n    const self = this;\n    if (d3.event && d3.event.translate) {\n      this.scale = d3.event.scale;\n      this.transX = (this.scale === 1) ? 0 : d3.event.translate[0];\n      this.transY = (this.scale === 1) ? 0 : d3.event.translate[1];\n    }\n\n    const maxTransX = 0;\n    const maxTransY = 0;\n    const minTransX = this.getWidth() * (1 - this.scale);\n    const minTransY = this.getHeight() * (1 - this.scale);\n\n    if (this.transY > maxTransY) {\n      this.transY = maxTransY;\n    } else if (this.transY < minTransY) {\n      this.transY = minTransY;\n    }\n\n    if (this.transX > maxTransX) {\n      this.transX = maxTransX;\n    } else if (this.transX < minTransX) {\n      this.transX = minTransX;\n    }\n\n    if (d3.event && d3.event.translate) {\n      d3.event.translate[0] = this.transX;\n      d3.event.translate[1] = this.transY;\n    }\n\n    this.layerGlobal.attr('transform',\n      `translate(${this.transX}, ${this.transY})scale(${this.scale})`);\n\n    // Hide tooltip\n    if (self.tooltipCountriesNode) self.tooltipCountriesNode.attr('style', 'display:none;');\n    if (self.tooltipMarkersNode) self.tooltipMarkersNode.attr('style', 'display:none;');\n\n    // Rescale markers size\n    if (this.options.markers) {\n      // markers\n      d3.selectAll(`${this.containerSelector} .mt-map-marker`).each(function (d) {\n        // stroke\n        if (d.attr['stroke-width']) {\n          d3.select(this).attr('stroke-width', d.attr['stroke-width'] / self.scaleAttributes());\n        }\n        // radius\n        if (d.attr.r) {\n          d3.select(this).attr('r', d.attr.r / self.scaleAttributes());\n        }\n      });\n    }\n\n    // Rescale Country stroke-width\n    if (this.options.countries) {\n      d3.selectAll(`${this.containerSelector} .mt-map-country`).style('stroke-width',\n        this.options.countries.attr['stroke-width'] / this.scale);\n    }\n\n    // Rescale heatmap borders\n    if (this.options.heatmap && this.options.heatmap.borders) {\n      d3.selectAll(`${this.containerSelector} .mt-map-heatmap-borders-paths`)\n        .style('stroke-width', this.options.heatmap.borders.stroke / this.scale);\n    }\n\n    // save state\n    if (this.options.saveState) this.saveState();\n  }\n\n  setAttrValues(attrKey, attrValue, dataset) {\n    if (typeof (attrValue) === 'number' || typeof (attrValue) === 'string') {\n      // Static value\n      dataset.forEach(d => {\n        d.attr[attrKey] = attrValue;\n      });\n    } else if (typeof (attrValue) === 'function') {\n      // Dynamic value based on the dataset\n      dataset.forEach(d => {\n        d.attr[attrKey] = attrValue(d);\n      });\n    } else if (typeof (attrValue) === 'object') {\n      // Dynamic value based on a scale\n      if (!attrValue.rollup) {\n        attrValue.rollup = (d) => d.length;\n      }\n      if (!attrValue.min || !attrValue.max) {\n        throw new Error(`MapTable: You should provide values 'min' & 'max' for attr.${attrKey}`);\n      }\n\n      dataset.forEach(d => {\n        d.rollupValue[attrKey] = attrValue.rollup(d.values);\n      });\n      const scaleDomain = d3.extent(dataset, d => Number(d.rollupValue[attrKey]));\n      if (attrValue.transform) {\n        scaleDomain[0] = attrValue.transform(scaleDomain[0], this.maptable.data);\n        scaleDomain[1] = attrValue.transform(scaleDomain[1], this.maptable.data);\n      }\n\n      let minValue = attrValue.min;\n      let maxValue = attrValue.max;\n\n      if (attrValue.min === 'minValue') {\n        minValue = scaleDomain[0];\n      }\n      if (attrValue.max === 'maxValue') {\n        maxValue = scaleDomain[1];\n      }\n\n      // check for negative color declarations\n      if ((attrValue.maxNegative && !attrValue.minNegative) ||\n          (!attrValue.maxNegative && attrValue.minNegative)) {\n        throw new Error('MapTable: maxNegative or minNegative undefined. Please declare both.');\n      }\n      const useNegative = (attrValue.maxNegative && attrValue.minNegative);\n      let scaleFunction;\n      let scaleNegativeFunction;\n      if (useNegative) {\n        scaleFunction = d3.scale.linear()\n            .domain([0, scaleDomain[1]])\n            .range([minValue, maxValue]);\n\n        scaleNegativeFunction = d3.scale.linear()\n            .domain([scaleDomain[0], 0])\n            .range([attrValue.maxNegative, attrValue.minNegative]);\n      } else {\n        scaleFunction = d3.scale.linear()\n            .domain(scaleDomain)\n            .range([minValue, maxValue]);\n      }\n\n      dataset.forEach(d => {\n        let scaledValue;\n        if (!d.values.length || isNaN(d.rollupValue[attrKey])) {\n          if (typeof (attrValue.empty) === 'undefined') {\n            throw new Error(`MapTable: no empty property found for attr.${attrKey}`);\n          }\n          scaledValue = attrValue.empty;\n        } else {\n          const originalValueRaw = d.rollupValue[attrKey];\n          const originalValue = (attrValue.transform) ?\n              attrValue.transform(originalValueRaw, this.maptable.data) : originalValueRaw;\n          if (useNegative && originalValue < 0) {\n            scaledValue = scaleNegativeFunction(originalValue);\n          } else {\n            scaledValue = scaleFunction(originalValue);\n          }\n        }\n        d.attr[attrKey] = scaledValue;\n      });\n    } else {\n      throw new Error(`Maptable: Invalid value for ${attrKey}`);\n    }\n  }\n\n  render() {\n    if (this.options.markers) this.updateMarkers();\n    if (this.options.countries) this.updateCountries();\n    if (this.options.title) this.updateTitle();\n    if (this.options.heatmap) this.updateHeatmap();\n    if (this.options.autoFitContent) {\n      this.fitContent();\n      this.rescale();\n    }\n  }\n\n  updateTitle() {\n    if (this.options.title.content) {\n      const showing = this.maptable.data.filter(d => d[this.options.latitudeKey] !== 0).length;\n      const total = this.maptable.rawData.filter(d => d[this.options.latitudeKey] !== 0).length;\n\n      let inlineFilters = '';\n      if (this.maptable.filters) {\n        inlineFilters = this.maptable.filters.getDescription();\n      }\n\n      document.getElementById('mt-map-title').innerHTML = this.options.title\n        .content(showing, total, inlineFilters, this.maptable.data, this.maptable.rawData);\n    }\n  }\n\n  activateTooltip(target, tooltipNode, tooltipContent) {\n    target.on('mouseover', function (d) {\n      const circleRect = this.getBoundingClientRect();\n      tooltipNode.html(tooltipContent(d)).attr('style', `display:block;position:fixed;`);\n      const tooltipDelta = tooltipNode.node().offsetWidth / 2;\n      const mouseLeft = (circleRect.left + (circleRect.width / 2) - tooltipDelta);\n      const mouseTop = (circleRect.top + circleRect.height);\n\n      tooltipNode.attr(\n        'style',\n        `top:${mouseTop}px;left:${mouseLeft}px;display:block;position:fixed;`\n      )\n      .on('mouseout', () => {\n        tooltipNode.style('display', 'none');\n      });\n    })\n    .on('mouseout', () => {\n      tooltipNode.style('display', 'none');\n    });\n  }\n\n  exportSvg() {\n    // Get the d3js SVG element\n    const svg = document.getElementById('mt-map-svg');\n    // Extract the data as SVG text string\n    const svgXml = `<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n${(new XMLSerializer).serializeToString(svg)}`;\n\n    if (this.options.exportSvgClient) {\n      if (!window.saveAs) {\n        throw new Error('MapTable: Missing FileSaver.js library');\n      }\n      const blob = new Blob([svgXml], { type: 'image/svg+xml' });\n      window.saveAs(blob, 'visualization.svg');\n    } else if (this.options.exportSvg) {\n      const form = this.node.getElementById('mt-map-svg-form');\n      form.querySelector('[name=\"data\"]').value = svgXml;\n      form.submit();\n    }\n  }\n\n  addExportSvgCapability() {\n    const exportNode = document.createElement('div');\n    exportNode.setAttribute('id', 'mt-map-export');\n    document.getElementById('mt-map').appendChild(exportNode);\n\n    const exportButton = document.createElement('button');\n    exportButton.setAttribute('class', 'btn btn-xs btn-default');\n    exportButton.innerHTML = 'Download';\n    exportButton.addEventListener('click', this.exportSvg.bind(this));\n    exportNode.appendChild(exportButton);\n\n    if (this.options.exportSvg) {\n      const exportForm = document.createElement('div');\n      exportForm.innerHTML = `<form id=\"mt-map-svg-form\" method=\"post\"\n  action=\"${this.options.exportSvg}\"><input type=\"hidden\" name=\"data\"></form>`;\n      exportNode.appendChild(exportForm);\n    }\n  }\n}\n","import utils from '../utils';\n\nexport default class Filters {\n  constructor(maptable, options) {\n    this.maptable = maptable;\n    this.options = options;\n    this.criteria = [];\n\n    if (this.options.show) {\n      const arrayDiff = this.options.show.filter(i => {\n        return Object.keys(this.maptable.columnDetails).indexOf(i) < 0;\n      });\n      if (arrayDiff.length > 0) {\n        throw new Error(`MapTable: invalid columns \"${arrayDiff.join(', ')}\"`);\n      }\n      this.activeColumns = this.options.show;\n    } else {\n      this.activeColumns = Object.keys(this.maptable.columnDetails);\n    }\n\n    this.container = document.createElement('div');\n    this.maptable.node.appendChild(this.container);\n\n    this.containerSelector = maptable.options.target;\n    this.container = document.querySelector(maptable.options.target);\n    this.node = this.container.querySelector('#mt-filters');\n\n    if (!this.node) {\n      this.node = document.createElement('div');\n      this.node.setAttribute('id', 'mt-filters');\n      this.node.setAttribute('class', 'panel panel-default');\n      this.maptable.node.appendChild(this.node);\n    }\n\n    // -- Filters Header\n\n    const filtersHeaderNode = document.createElement('div');\n    filtersHeaderNode.setAttribute('class', 'panel-heading');\n\n    const filtersResetNode = document.createElement('button');\n    filtersResetNode.setAttribute('id', 'mt-filters-reset');\n    filtersResetNode.setAttribute('class', 'btn btn-default btn-xs pull-right');\n    filtersResetNode.style.display = 'none';\n    filtersResetNode.style.marginLeft = 5;\n    filtersResetNode.innerText = '↺ Reset';\n    filtersResetNode.addEventListener('click', this.reset);\n    filtersHeaderNode.appendChild(filtersResetNode);\n\n    const filtersTitleNode = document.createElement('h3');\n    filtersTitleNode.setAttribute('class', 'panel-title');\n    filtersTitleNode.appendChild(document.createTextNode('Filters'));\n    filtersHeaderNode.appendChild(filtersTitleNode);\n\n    this.node.appendChild(filtersHeaderNode);\n\n    // -- Filters Content\n    const filtersBodyNode = document.createElement('div');\n    filtersBodyNode.setAttribute('id', 'mt-filters-content');\n    filtersBodyNode.setAttribute('class', 'panel-body');\n\n    const filtersElementsNode = document.createElement('div');\n    filtersElementsNode.setAttribute('id', 'mt-filters-elements');\n    filtersBodyNode.appendChild(filtersElementsNode);\n\n    const filtersNewNode = document.createElement('a');\n    filtersNewNode.setAttribute('id', 'mt-filters-new');\n    filtersNewNode.setAttribute('href', '#');\n    filtersNewNode.innerText = '+ New filter';\n    filtersNewNode.addEventListener('click', this.add.bind(this));\n    filtersBodyNode.appendChild(filtersNewNode);\n\n    this.node.appendChild(filtersBodyNode);\n  }\n\n  /**\n   * Add a filter\n   * @param evt: Window Event Object\n   */\n  add(evt) {\n    if (evt) evt.preventDefault();\n    const possibleFilters = this.getPossibleFilters();\n\n    if (possibleFilters.length === 0) {\n      return;\n    }\n    const filterName = possibleFilters[0].key;\n    this.create(filterName);\n  }\n\n  create(filterName, replaceNode) {\n    const rowNode = this.buildRow(filterName);\n    if (replaceNode) {\n      replaceNode.parentNode.replaceChild(rowNode, replaceNode);\n    } else {\n      this.node.querySelector('#mt-filters-elements').appendChild(rowNode);\n    }\n    this.criteria.push(filterName);\n    this.maptable.render();\n    if (this.container.style.display === 'none') {\n      this.toggle();\n    }\n  }\n\n  remove(filterName) {\n    const rowNode = this.node.querySelector(`[data-mt-filter-name=\"${filterName}\"]`);\n    if (rowNode) rowNode.parentNode.removeChild(rowNode);\n    const filterIndex = this.criteria.indexOf(filterName);\n    this.criteria.splice(filterIndex, 1);\n    this.maptable.render();\n  }\n\n  /**\n   * Reset filters\n   */\n  reset() {\n    const rowNodes = this.node.querySelectorAll('[data-mt-filter-name]');\n    for (let i = 0; i < rowNodes.length; i++) {\n      rowNodes[i].parentNode.removeChild(rowNodes[i]);\n    }\n    this.criteria = [];\n    this.maptable.render();\n  }\n\n  /**\n   * Export the current filters to an object\n   * @returns exportedFilters: Object - key => value that contain data about the current filters\n   */\n  exportFilters() {\n    const output = {};\n    const filtersChildren = this.node.querySelector('#mt-filters-elements').childNodes;\n\n    for (let i = 0; i < filtersChildren.length; i++) {\n      const element = filtersChildren[i];\n      const filterName = element.querySelector('.mt-filter-name').value;\n      const columnDetails = this.maptable.columnDetails[filterName];\n      const filterOutput = [columnDetails.filterMethod];\n      if (columnDetails.filterMethod === 'compare') {\n        const filterRangeSelect = element.querySelector('.mt-filter-range');\n        filterOutput[1] = filterRangeSelect.value;\n        if (filterRangeSelect.value !== 'any') {\n          if (filterRangeSelect.value === 'BETWEEN') {\n            const filterValueMin = element.querySelector('.mt-filter-value-min').value;\n            const filterValueMax = element.querySelector('.mt-filter-value-max').value;\n            if (filterValueMin !== '' && filterValueMax === '') {\n              filterOutput[2] = filterValueMin;\n              filterOutput[3] = filterValueMax;\n            }\n          } else {\n            const filterValue = element.querySelector('.mt-filter-value-min').value;\n            filterOutput[2] = filterValue;\n          }\n        }\n      } else if (columnDetails.filterMethod === 'field' ||\n        columnDetails.filterMethod === 'dropdown') {\n        filterOutput[1] = '';\n        const filterValue = element.querySelector('.mt-filter-value').value;\n        filterOutput[2] = filterValue;\n      }\n      if (filterOutput[1] !== 'any' && filterOutput[2] && filterOutput[2] !== '') {\n        output[filterName] = filterOutput;\n      }\n    }\n    return output;\n  }\n\n  /**\n   * Set the value for the current filters\n   * @param criteria - Object - same format as the exportedFilters\n   */\n  setFilters(criteria) {\n    this.reset();\n    Object.keys(criteria).forEach(filterName => {\n      this.create(filterName);\n      const criterion = criteria[filterName];\n      const row = document\n      .querySelector(`#mt-filters-elements [data-mt-filter-name=\"${filterName}\"]`);\n      if (row) {\n        if (criterion[0] === 'compare') {\n          row.querySelector('.mt-filter-range').value = criterion[1];\n          if (criterion[1] !== 'any') {\n            if (criterion[1] === 'BETWEEN') {\n              row.querySelector('.mt-filter-value-min').value = criterion[2];\n              row.querySelector('.mt-filter-value-max').value = criterion[3];\n            } else {\n              row.querySelector('.mt-filter-value-min').value = criterion[2];\n            }\n          }\n        } else if (criterion[0] === 'field' || criterion[0] === 'dropdown') {\n          row.querySelector('.mt-filter-value').value = decodeURIComponent(criterion[2]);\n        }\n      }\n    });\n    this.maptable.render();\n  }\n\n  /**\n   * Restore state from the URL hash\n   */\n  restoreState() {\n    const params = document.location.href.replace(/%21mt/g, '!mt').split('!mt-filters=');\n    const defaultCriteria = (params[1]) ? params[1].split('!mt')[0] : null;\n    if (defaultCriteria) {\n      try {\n        this.setFilters(JSON.parse(decodeURIComponent(defaultCriteria)));\n      } catch (e) {\n        console.log(`Maptable: Invalid URL State for mt-filters ${e.message}`);\n      }\n    }\n  }\n\n  /**\n   *  Get a human readable description of the filters (used for the title)\n   * @returns {string} Human readable description\n   */\n  getDescription() {\n    const outputArray = [];\n\n    const filtersChildren = this.node.querySelector('#mt-filters-elements').childNodes;\n\n    for (let i = 0; i < filtersChildren.length; i++) {\n      const element = filtersChildren[i];\n      const filterName = element.querySelector('.mt-filter-name').value;\n\n      const columnDetails = this.maptable.columnDetails[filterName];\n\n      let line = '';\n\n      if (columnDetails.filterMethod === 'compare') {\n        const filterRangeSelect = element.querySelector('.mt-filter-range');\n        if (filterRangeSelect.value !== 'any') {\n          if (filterRangeSelect.value === 'BETWEEN') {\n            const filterValueMin = element.querySelector('.mt-filter-value-min').value;\n            const filterValueMax = element.querySelector('.mt-filter-value-max').value;\n            if (filterValueMin === '' || filterValueMax === '') continue;\n            line += `${columnDetails.title} is between `;\n            line += `<tspan font-weight=\"bold\">${filterValueMin}</tspan> and\n              <tspan font-weight=\"bold\">${filterValueMax}</tspan>`;\n          } else {\n            const filterValue = element.querySelector('.mt-filter-value-min').value;\n            if (filterValue === '') continue;\n            line += `${columnDetails.title} is `;\n            line += filterRangeSelect.options[filterRangeSelect.selectedIndex].text;\n            line += `<tspan font-weight=\"bold\">${filterValue}</tspan>`;\n          }\n        }\n      } else if (columnDetails.filterMethod === 'field' ||\n        columnDetails.filterMethod === 'dropdown') {\n        const filterValue = element.querySelector('.mt-filter-value').value;\n        if (filterValue === '') continue;\n        const separatorWord = (columnDetails.filterMethod === 'field') ? 'contains' : 'is';\n        line += `${columnDetails.title} ${separatorWord}\n          <tspan font-weight=\"bold\">${filterValue}</tspan>`;\n      }\n      outputArray.push(line);\n    }\n    return outputArray.join(', ');\n  }\n\n  buildRow(filterName) {\n    const that = this;\n\n    const possibleFilters = this.getPossibleFilters();\n\n    const columnDetails = this.maptable.columnDetails[filterName];\n\n    const rowNode = document.createElement('div');\n    rowNode.setAttribute('class', 'mt-filter-row');\n    rowNode.setAttribute('data-mt-filter-name', filterName);\n\n    // Button to remove filter\n    const minusButton = document.createElement('button');\n    minusButton.setAttribute('class', 'btn btn-default pull-right');\n    minusButton.setAttribute('data-mt-filter-btn-minus', 1);\n    minusButton.innerText = '– Remove this filter';\n    minusButton.addEventListener('click', () => {\n      filterName = rowNode.querySelector('.mt-filter-name').value;\n      this.remove(filterName);\n    });\n    rowNode.appendChild(minusButton);\n\n    // Filters separator \"AND\"\n    const filterSeparator = document.createElement('span');\n    filterSeparator.setAttribute('class', 'mt-filters-and');\n    filterSeparator.innerText = 'And ';\n    rowNode.appendChild(filterSeparator);\n\n    // Filter name select\n    const filterNameSelect = document.createElement('select');\n    filterNameSelect.setAttribute('class', 'mt-filter-name form-control form-control-inline');\n    utils.appendOptions(filterNameSelect, possibleFilters.map(f => {\n      return { text: f.title, value: f.key };\n    }));\n    filterNameSelect.value = filterName;\n\n    filterNameSelect.addEventListener('change', function () {\n      const oldFilterName = this.parentNode.getAttribute('data-mt-filter-name');\n      const newFilterName = this.value;\n      that.create(newFilterName, this.parentNode);\n      that.remove(oldFilterName);\n      that.refresh();\n    });\n    rowNode.appendChild(filterNameSelect);\n\n    // Filter verb\n    const filterVerb = document.createElement('span');\n    filterVerb.innerText = (columnDetails.filterMethod === 'field') ? ' contains ' : ' is ';\n    rowNode.appendChild(filterVerb);\n\n    // Filter range\n    let filterRange = null;\n    if (columnDetails.filterMethod !== 'field' && columnDetails.filterMethod !== 'dropdown') {\n      filterRange = document.createElement('select');\n      filterRange.setAttribute('class', 'mt-filter-range form-control form-control-inline');\n      utils.appendOptions(filterRange, ['any', '=', '≠', '<', '>', '≤', '≥', 'BETWEEN'].map(v => {\n        return { text: v, value: v };\n      }));\n      filterRange.addEventListener('change', function () {\n        that.handleRangeChange(this);\n      });\n      rowNode.appendChild(filterRange);\n\n      // Little space:\n      rowNode.appendChild(document.createTextNode(' '));\n    }\n\n    // Filter value\n    const filterValue = document.createElement('div');\n    filterValue.style.display = 'inline-block';\n    filterValue.setAttribute('class', 'mt-filter-value-container');\n\n    if (columnDetails.filterMethod === 'compare') {\n      ['min', 'max'].forEach((val, i) => {\n        const filterInput = document.createElement('input');\n        filterInput.setAttribute('class',\n          `form-control form-control-inline mt-filter-value-${val}`);\n        filterInput.setAttribute('type', columnDetails.filterInputType);\n        filterInput.addEventListener('keyup', this.maptable.render.bind(this.maptable));\n        filterInput.addEventListener('change', this.maptable.render.bind(this.maptable));\n        filterValue.appendChild(filterInput);\n        if (i === 0) {\n          // AND\n          const filterValueAnd = document.createElement('span');\n          filterValueAnd.setAttribute('class', 'mt-filter-value-and');\n          filterValueAnd.innerText = ' and ';\n          filterValue.appendChild(filterValueAnd);\n        }\n      });\n    } else if (columnDetails.filterMethod === 'field') {\n      const filterInput = document.createElement('input');\n      filterInput.setAttribute('class', 'form-control form-control-inline mt-filter-value');\n      filterInput.setAttribute('type', 'text');\n      filterInput.addEventListener('keyup', this.maptable.render.bind(this.maptable));\n      filterInput.addEventListener('change', this.maptable.render.bind(this.maptable));\n      filterValue.appendChild(filterInput);\n    } else if (columnDetails.filterMethod === 'dropdown') {\n      const filterSelect = document.createElement('select');\n      filterSelect.setAttribute('class', 'form-control form-control-inline mt-filter-value');\n\n      const uniqueValues = d3.nest().key(d => d[filterName])\n        .sortKeys(d3.ascending)\n        .entries(this.maptable.rawData);\n\n      utils.appendOptions(filterSelect, [{ text: 'Any', value: '' }].concat(uniqueValues.map(k => {\n        return { text: k.key, value: k.key };\n      })));\n\n      filterSelect.addEventListener('change', this.maptable.render.bind(this.maptable));\n      filterValue.appendChild(filterSelect);\n    }\n\n    rowNode.appendChild(filterValue);\n\n    // We trigger it here to handle the value of the filter range\n    if (filterRange) {\n      this.handleRangeChange(filterRange);\n    }\n\n    return rowNode;\n  }\n\n  handleRangeChange(filterRange) {\n    const rowNode = filterRange.parentNode;\n    if (filterRange.value === 'any') {\n      rowNode.querySelector('.mt-filter-value-container').style.display = 'none';\n    } else {\n      rowNode.querySelector('.mt-filter-value-container').style.display = 'inline-block';\n      if (filterRange.value === 'BETWEEN') {\n        rowNode.querySelector('.mt-filter-value-min').style.display = 'inline-block';\n        rowNode.querySelector('.mt-filter-value-and').style.display = 'inline-block';\n        rowNode.querySelector('.mt-filter-value-max').style.display = 'inline-block';\n      } else {\n        rowNode.querySelector('.mt-filter-value-min').style.display = 'inline-block';\n        rowNode.querySelector('.mt-filter-value-and').style.display = 'none';\n        rowNode.querySelector('.mt-filter-value-max').style.display = 'none';\n      }\n    }\n  }\n\n  getPossibleFilters(except) {\n    return Object.keys(this.maptable.columnDetails)\n      .map(k => utils.extendRecursive({ key: k }, this.maptable.columnDetails[k]))\n      .filter(v => {\n        return (this.activeColumns.indexOf(v.key) !== -1) &&\n        (\n          (except && except === v.key) ||\n          (this.criteria.indexOf(v.key) === -1 && v.filterMethod && !v.isVirtual)\n        );\n      });\n  }\n\n  filterData() {\n    const that = this;\n    this.maptable.data = this.maptable.rawData.filter(d => {\n      const rowNodes = this.node.querySelectorAll('.mt-filter-row');\n      let matched = true;\n      for (let i = 0; i < rowNodes.length && matched; i++) {\n        const rowNode = rowNodes[i];\n        const filterName = rowNode.getAttribute('data-mt-filter-name');\n        const columnDetails = that.maptable.columnDetails[filterName];\n        const fmt = columnDetails.dataParse; // shortcut\n\n        if (columnDetails.filterMethod === 'dropdown') {\n          const filterValue = rowNode.querySelector('.mt-filter-value').value;\n          if (filterValue === '') continue;\n          if (d[filterName] !== filterValue) matched = false;\n        } else if (columnDetails.filterMethod === 'field') {\n          const filterValue = rowNode.querySelector('.mt-filter-value').value;\n          if (filterValue === '') continue;\n          if (d[filterName].toLowerCase().indexOf(filterValue.toLowerCase()) === -1) {\n            matched = false;\n          }\n        } else if (columnDetails.filterMethod === 'compare') {\n          const filterRange = rowNode.querySelector('.mt-filter-range').value;\n          if (filterRange === 'BETWEEN') {\n            const filterValueMin = rowNode.querySelector('.mt-filter-value-min').value;\n            const filterValueMax = rowNode.querySelector('.mt-filter-value-max').value;\n            if (filterValueMin === '' || filterValueMax === '') continue;\n            if (fmt &&\n                (fmt(d[filterName]) < fmt(filterValueMin) ||\n                fmt(d[filterName]) > fmt(filterValueMax))\n            ) {\n              matched = false;\n            } else if (\n                parseInt(d[filterName], 10) < parseInt(filterValueMin, 10) ||\n                parseInt(d[filterName], 10) > parseInt(filterValueMax, 10)\n            ) {\n              matched = false;\n            }\n          } else {\n            const filterValue = rowNode.querySelector('.mt-filter-value-min').value;\n            if (filterValue === '') continue;\n            if (fmt && !utils.rangeToBool(fmt(d[filterName]), filterRange, fmt(filterValue))) {\n              matched = false;\n            } else if (!fmt && !utils.rangeToBool(d[filterName], filterRange, filterValue)) {\n              matched = false;\n            }\n          }\n        }\n      }\n      return matched;\n    });\n    // save state\n    if (this.options.saveState) this.maptable.saveState('filters', this.exportFilters());\n  }\n\n  refresh() {\n    // update dropdown\n    const filterNameSelects = this.node.querySelectorAll('.mt-filter-name');\n    for (let i = 0; i < filterNameSelects.length; i++) {\n      const filterNameSelect = filterNameSelects[i];\n      const filterName = filterNameSelect.value;\n      const possibleFilters = this.getPossibleFilters(filterName);\n      filterNameSelect.innerHTML = '';\n      utils.appendOptions(filterNameSelect, possibleFilters.map(f => {\n        return { text: f.title, value: f.key };\n      }));\n      filterNameSelect.value = filterName;\n    }\n\n    // Hide the first \"And\"\n    if (this.node.querySelectorAll('.mt-filters-and').length > 0) {\n      this.node.querySelectorAll('.mt-filters-and')[0].style.visibility = 'hidden';\n    }\n\n    // Check if we reached the maximum of allowed filters\n    const disableNewFilter = (!this.getPossibleFilters().length);\n    this.node.querySelector('#mt-filters-new').style.visibility = disableNewFilter ?\n      'hidden' : 'visible';\n  }\n\n  toggle() {\n    if (this.container.style.display === 'none') {\n      this.container.style.display = 'block';\n      if (this.criteria.length === 0) {\n        this.add();\n      }\n    } else {\n      this.container.style.display = 'none';\n    }\n  }\n}\n","import utils from '../utils';\n\nexport default class Table {\n  /**\n   * Table componenet constructor\n   * @param maptable: Maptable main Object\n   * @param options: options communicated to the table\n   * @returns {string|*}\n   */\n  constructor(maptable, options) {\n    this.maptable = maptable;\n    this.options = options;\n    this.sorting = [\n      {\n        key: Object.keys(this.maptable.data[0])[0],\n        mode: 'asc',\n      },\n    ];\n    this.isSorting = false;\n\n    this.containerSelector = maptable.options.target;\n    this.container = document.querySelector(maptable.options.target);\n\n    this.node = this.container.querySelector('#mt-table');\n\n    if (!this.node) {\n      this.node = document.createElement('div');\n      this.node.setAttribute('id', 'mt-table');\n      this.maptable.node.appendChild(this.node);\n    }\n\n    this.node = d3.select(this.node)\n      .append('table')\n      .attr('class', this.options.className);\n\n    this.header = this.node.append('thead');\n\n    this.body = this.node.append('tbody');\n\n    if (this.options.show) {\n      const arrayDiff = this.options.show.filter(i => {\n        return Object.keys(this.maptable.columnDetails).indexOf(i) < 0;\n      });\n      if (arrayDiff.length > 0) {\n        throw new Error(`MapTable: invalid columns \"${arrayDiff.join(', ')}\"`);\n      }\n      this.activeColumns = this.options.show;\n    } else {\n      this.activeColumns = Object.keys(this.maptable.columnDetails);\n    }\n\n    this.header.selectAll('tr')\n      .data([1])\n      .enter()\n      .append('tr')\n      .selectAll('th')\n      .data(this.activeColumns.map(k => {\n        return utils.extendRecursive({ key: k }, this.maptable.columnDetails[k]);\n      }))\n      .enter()\n      .append('th')\n      .attr('class', d => {\n        let output = (d.sorting) ? 'mt-table-sortable' : '';\n        output += (d.nowrap) ? ' nowrap' : '';\n        return output;\n      })\n      .attr('onselectstart', 'return false;')\n      .attr('unselectable', 'on')\n      .attr('style', d => {\n        return (d.nowrap) ? 'white-space:nowrap;' : '';\n      })\n      .on('click', d => {\n        if (this.isSorting) return;\n        this.isSorting = true;\n        if (d.sorting) {\n          this.sortColumn(d.key);\n        }\n        this.isSorting = false;\n      })\n      .text(d => d.title)\n      .attr('id', d => `column_header_${utils.sanitizeKey(d.key)}`);\n\n    if (this.options.defaultSorting) {\n      if (Array.isArray(this.options.defaultSorting) && this.options.defaultSorting.length === 2) {\n        this.sorting = this.options.defaultSorting;\n      } else {\n        this.sorting = [this.options.defaultSorting];\n      }\n    }\n    this.render();\n\n    // On complete\n    if (this.options.onComplete && this.options.onComplete.constructor === Function) {\n      this.options.onComplete.bind(this.maptable)();\n    }\n  }\n\n\n  render() {\n    // Apply Sort\n    this.applySort();\n\n    // Enter\n    this.body.selectAll('tr')\n      .data(this.maptable.data)\n      .enter()\n      .append('tr');\n\n    // Exit\n    this.body.selectAll('tr')\n      .data(this.maptable.data)\n      .exit()\n      .remove();\n\n    // Update\n    const uniqueCollapsedRows = [];\n    this.body.selectAll('tr')\n      .data(this.maptable.data)\n      .attr('class', row => {\n        if (this.options.rowClassName) {\n          return `line ${this.options.rowClassName(row)}`;\n        }\n        return 'line';\n      })\n      .html(row => {\n        let tds = '';\n        this.activeColumns.forEach(columnKey => {\n          const column = this.maptable.columnDetails[columnKey];\n          tds += '<td';\n          if (column.nowrap) {\n            tds += ' style=\"white-space:nowrap;\"';\n          }\n          tds += '>';\n\n          if (!(\n              this.options.collapseRowsBy.indexOf(columnKey) !== -1 &&\n              uniqueCollapsedRows[columnKey] &&\n              uniqueCollapsedRows[columnKey] === row[columnKey]\n            )) {\n            if (column.cellContent) {\n              tds += column.cellContent(row);\n            } else if (column.virtual) {\n              tds += column.virtual(row);\n            } else {\n              if (row[columnKey] && row[columnKey] !== 'null') tds += row[columnKey];\n            }\n            if (this.options.collapseRowsBy.indexOf(columnKey) !== -1) {\n              uniqueCollapsedRows[columnKey] = row[columnKey];\n            }\n          }\n          tds += '</td>';\n        });\n        return tds;\n      });\n  }\n\n  applySort() {\n    const sortableColums = document.querySelectorAll('.mt-table-sortable');\n    for (let i = 0; i < sortableColums.length; i += 1) {\n      sortableColums[i].setAttribute('class', 'mt-table-sortable');\n    }\n    this.sorting.forEach((column) => {\n      document.getElementById(`column_header_${utils.sanitizeKey(column.key)}`)\n        .setAttribute('class', `mt-table-sortable sort_${column.mode}`);\n    });\n    this.maptable.data = this.maptable.data.sort((a, b) => {\n      let compareBool = false;\n      this.sorting.forEach((column) => {\n        const d3SortMode = (column.mode === 'asc') ? d3.ascending : d3.descending;\n        const columnDetails = this.maptable.columnDetails[column.key];\n        let el1 = a[column.key];\n        let el2 = b[column.key];\n        if (columnDetails.dataParse) {\n          el1 = columnDetails.dataParse(el1);\n          el2 = columnDetails.dataParse(el2);\n        } else if (columnDetails.virtual) {\n          el2 = columnDetails.virtual(a);\n          el2 = columnDetails.virtual(b);\n        } else if (columnDetails.filterType === 'compare') {\n          el1 = Number(el1);\n          el2 = Number(el2);\n        } else if (el1 instanceof String && el2 instanceof String) {\n          el1 = el1.toLowerCase();\n          el2 = el2.toLowerCase();\n        }\n        compareBool = compareBool || d3SortMode(el1, el2);\n      });\n      return compareBool;\n    });\n  }\n\n  /**\n   * Sort Table by a column key\n   * @param columnKey: String - column key\n   */\n  sortColumn(key) {\n    const sortIndex = this.sorting.map(d => d.key).indexOf(key);\n    const sortValue = { key };\n    if (sortIndex === -1) {\n      sortValue.mode = 'asc';\n      if (d3.event && d3.event.shiftKey) {\n        this.sorting[1] = sortValue;\n      } else {\n        this.sorting = [sortValue];\n      }\n    } else {\n      if (this.sorting[sortIndex].mode === 'asc') {\n        this.sorting[sortIndex].mode = 'desc';\n      } else {\n        this.sorting[sortIndex].mode = 'asc';\n        // this.sorting.splice(sortIndex, 1); // to disable sorting\n      }\n      if (!d3.event.shiftKey) {\n        this.sorting = [this.sorting[sortIndex]];\n      }\n    }\n\n    this.render();\n  }\n}\n","import utils from './utils';\n\nimport GeoMap from './components/GeoMap';\nimport Filters from './components/Filters';\nimport Table from './components/Table';\n\nexport default class MapTable {\n  constructor(target, options) {\n    this.options = options;\n\n    this.state = {\n      filters: {},\n      zoom: {},\n    };\n    this.saveStateTimeout = {};\n\n    this.node = document.querySelector(target);\n    this.node.setAttribute('style', 'position:relative;');\n\n    if (this.options.data.type === 'json') {\n      d3.json(this.options.data.path, this.loadData.bind(this));\n    } else if (this.options.data.type === 'csv') {\n      d3.csv(this.options.data.path, this.loadData.bind(this));\n    } else if (this.options.data.type === 'tsv') {\n      d3.tsv(this.options.data.path, this.loadData.bind(this));\n    }\n\n    if (this.options.map && this.options.map.heatmap) {\n      delete this.options.map.countries;\n    }\n  }\n\n  /**\n   * Callback used when we pull the dataset\n   * @param err: Error - error data if it happened\n   * @param data: Object - dataset object\n   */\n  loadData(err, data) {\n    if (err) {\n      throw err;\n    }\n    this.rawData = data;\n\n    if (this.options.data.preFilter) {\n      this.rawData = this.rawData.filter(this.options.data.preFilter);\n    }\n\n    this.setColumnDetails();\n    this.data = this.rawData.slice(); // we clone data, so that we can filter it\n    // Map\n    if (this.options.map) {\n      // Map wrapper\n      const mapWrapper = document.createElement('div');\n      mapWrapper.setAttribute('class', 'mt-map-container');\n      const isIE = (navigator.userAgent.indexOf('MSIE') !== -1 || navigator.appVersion.indexOf('Trident/') > 0);\n      if (this.options.map.heatmap && isIE) {\n        mapWrapper.innerHTML = '<div class=\"mt-loading\">The heatmap feature is not supported with Internet Explorer.<br>Please use another modern browser to see this map.</div>';\n        this.node.insertBefore(mapWrapper, this.node.firstChild);\n        mapWrapper.querySelector('.mt-loading').style.display = 'block';\n        this.options.map = false;\n        this.buildComponenents();\n        return;\n      }\n      mapWrapper.innerHTML = '<div class=\"mt-loading\">Loading...</div>';\n      this.node.insertBefore(mapWrapper, this.node.firstChild);\n      mapWrapper.querySelector('.mt-loading').style.display = 'block';\n      d3.json(this.options.map.path, (errGeoMap, jsonWorld) => {\n        if (errGeoMap) {\n          throw errGeoMap;\n        }\n        this.map = new GeoMap(this, this.options.map, jsonWorld);\n\n        mapWrapper.querySelector('.mt-loading').style.display = 'none';\n\n        this.buildComponenents();\n      });\n    } else {\n      this.buildComponenents();\n    }\n  }\n\n  buildComponenents() {\n    // Filters\n    if (this.options.filters) {\n      this.filters = new Filters(this, this.options.filters);\n    }\n\n    // Table\n    if (this.options.table) {\n      this.table = new Table(this, this.options.table);\n    }\n\n    // Render\n    this.render();\n\n    // Restore state\n    this.restoreState();\n    window.addEventListener('hashchange', () => {\n      this.restoreState();\n    });\n  }\n\n  /**\n   * Restore state for filters or/and map zooming\n   */\n  restoreState() {\n    if (this.map) this.map.restoreState();\n    if (this.filters) this.filters.restoreState();\n  }\n\n\n  /**\n   * Save the state into the URL hash\n   * @param stateName: name of the state (either filters or zoom)\n   * @param stateData: object, contain state information\n   */\n  saveState(stateName, stateData) {\n    window.clearTimeout(this.saveStateTimeout[stateName]);\n    this.saveStateTimeout[stateName] = window.setTimeout(() => {\n      this.state[stateName] = stateData;\n      const newUrl = document.location.href.split('#')[0];\n      let stateHash = '';\n      ['filters', 'zoom'].forEach((f) => {\n        if (Object.keys(this.state[f]).length) {\n          stateHash += `!mt-${f}=${encodeURIComponent(JSON.stringify(this.state[f]))}`;\n        }\n      });\n      if (stateHash !== '') stateHash = `#${stateHash}`;\n      window.history.pushState(null, null, `${newUrl}${stateHash}`);\n    }, 200);\n  }\n\n  render() {\n    if (this.filters) {\n      this.filters.filterData();\n      this.filters.refresh();\n    }\n\n    if (this.map) {\n      this.map.render();\n    }\n\n    if (this.table) {\n      this.table.render();\n    }\n\n    // On complete\n    if (this.options.onComplete && this.options.onComplete.constructor === Function) {\n      this.options.onComplete.bind(this.maptable)();\n    }\n  }\n\n  setColumnDetails() {\n    const that = this;\n    if (that.rawData.length === 0) {\n      return;\n    }\n    const defaultColumns = {};\n\n    Object.keys(that.rawData[0]).forEach(k => {\n      const patternNumber = /^[-+]?[0-9]*\\.?[0-9]+([eE][-+]?[0-9]+)?$/;\n      const isNumber = (patternNumber.test(that.rawData[0][k]));\n      defaultColumns[k] = {\n        title: utils.keyToTile(k),\n        filterMethod: (isNumber) ? 'compare' : 'field',\n        filterInputType: (isNumber) ? 'number' : 'text',\n        sorting: true,\n      };\n      if (isNumber) {\n        defaultColumns[k].dataParse = (val) => parseFloat(val);\n      }\n    });\n    that.columnDetails = utils.extendRecursive(defaultColumns, this.options.columns);\n\n    // add isVirtual to columns details\n    Object.keys(that.columnDetails).forEach(k => {\n      that.columnDetails[k].isVirtual = (typeof (that.columnDetails[k].virtual) === 'function');\n    });\n  }\n}\n","/* eslint no-unused-vars: 0 */\nimport utils from './utils';\nimport defaultOptions from './defaultOptions';\nimport MapTable from './maptable';\n\nd3.maptable = function (target) {\n  let maptableObject;\n  const maptable = {};\n  const options = {\n    target: target,\n    columns: {},\n    data: {},\n    map: null,\n    filters: null,\n    table: null,\n  };\n\n  maptable.map = function (mapOptions = {}) {\n    if (!topojson) {\n      throw new Error('Maptable requires topojson.js');\n    }\n    if (typeof(mapOptions.path) !== 'string') {\n      throw new Error('MapTable: map not provided');\n    }\n    options.map = mapOptions;\n    return maptable;\n  };\n\n  maptable.json = function (jsonPath, preFilter) {\n    options.data.type = 'json';\n    options.data.path = jsonPath;\n    options.data.preFilter = preFilter;\n    return maptable;\n  };\n\n  maptable.csv = function (csvPath, preFilter) {\n    options.data.type = 'csv';\n    options.data.path = csvPath;\n    options.data.preFilter = preFilter;\n    return maptable;\n  };\n\n  maptable.tsv = function (tsvPath, preFilter) {\n    options.data.type = 'tsv';\n    options.data.path = tsvPath;\n    options.data.preFilter = preFilter;\n    return maptable;\n  };\n\n  maptable.filters = function (filtersOptions = {}) {\n    options.filters = filtersOptions;\n    return maptable;\n  };\n\n  maptable.table = function (tableOptions = {}) {\n    options.table = tableOptions;\n    return maptable;\n  };\n\n  maptable.columns = function (columns = {}) {\n    options.columns = columns;\n    return maptable;\n  };\n\n  maptable.render = function (onComplete) {\n    if (typeof(target) !== 'string' || !document.querySelector(target)) {\n      throw new Error('MapTable: target not found');\n    }\n\n    if (!options.data || !options.data.path) {\n      throw new Error('MapTable: Please provide the path for your dataset json|csv|tsv');\n    }\n\n    if (options.map && !options.map.heatmap) options.map.heatmap = null;\n\n    if (options.map && options.map.markers === false) options.map.markers = null;\n\n    if (options.map && options.map.countries === false) options.map.countries = null;\n\n    if (!options.filters) options.filters = null;\n    options.onComplete = onComplete;\n\n    const customOptions = utils.extendRecursive(defaultOptions, options);\n    maptableObject = new MapTable(target, customOptions);\n  };\n  return maptable;\n};\n\nif (!d3) {\n  throw new Error('Maptable requires d3.js');\n}\n\nexport default d3.maptable;\n"],"names":["appendOptions","select","options","defaultValue","forEach","option","document","createElement","setAttribute","f","value","innerText","text","appendChild","rangeToBool","el1","range","el2","parseInt","extendRecursive","dst","src","p","args","splice","call","arguments","toString","length","hasOwnProperty","keyToTile","k","upperK","charAt","toUpperCase","slice","replace","sanitizeKey","toLowerCase","map","longitudeKey","latitudeKey","countryIdentifierKey","countryIdentifierType","zoom","saveState","exportSvg","exportSvgClient","ratioFromWidth","scaleHeight","scaleZoom","fitContentMargin","autoFitContent","tooltipClassName","countries","legend","attr","fill","stroke","heatmap","mask","weightByAttribute","weightByAttributeScale","circles","min","max","step","color","colorStrength","blur","borders","opacity","markers","r","title","fontSize","fontFamily","filters","table","className","collapseRowsBy","Legend","legendWidth","node","svg","append","getWidth","getHeight","buildIndice","domain","legendGradient","minNegative","maxNegative","midPercentNegative","Math","round","midPercentPositive","indice","getElementById","style","buildScale","val","isNaN","maxValue","minValue","positionDelta","position","width","height","padding","console","warn","window","btoa","buildWatermark","d3","xhr","mapWatermarkDelta","mime","x","y","indexOf","dataUri","res","responseText","pos","split","mul_table","shg_table","processImage","img","canvas","radius","blurAlphaChannel","HTMLImageElement","w","naturalWidth","h","naturalHeight","HTMLCanvasElement","context","getContext","clearRect","drawImage","processCanvasRGBA","processCanvasRGB","getImageDataFromCanvas","top_x","top_y","imageData","getImageData","e","Error","processImageDataRGBA","putImageData","pixels","data","i","yp","yi","yw","r_sum","g_sum","b_sum","a_sum","r_out_sum","g_out_sum","b_out_sum","a_out_sum","r_in_sum","g_in_sum","b_in_sum","a_in_sum","pr","pg","pb","pa","rbs","div","w4","widthMinus1","heightMinus1","radiusPlus1","sumFactor","stackStart","BlurStack","stack","next","stackEnd","stackIn","stackOut","mul_sum","shg_sum","g","b","a","processImageDataRGB","image","canvasRGBA","canvasRGB","imageDataRGBA","imageDataRGB","GeoMap","maptable","jsonWorld","self","scale","transX","transY","containerSelector","target","container","querySelector","mapWrapper","projection","geo","equirectangular","translate","rotate","precision","path","rawData","d","longitude","parseFloat","latitude","coord","zoomListener","behavior","scaleExtent","on","rescale","bind","tooltipMarkersNode","tooltipCountriesNode","layerGlobal","layerCountries","layerHeatmap","layerMarkers","watermark","Watermark","buildTitle","addExportSvgCapability","addEventListener","loadGeometries","onComplete","constructor","Function","pow","offsetWidth","deltaHeight","filterCountries","objects","geometries","filter","buildCountries","buildHeatmap","lands","topojson","merge","disableMask","maskHeatmap","datum","imgHeatmap","mesh","bordersHeatmap","selectAll","enter","heatmapDataset","opts","lengthDataset","maxOpacityScale","linear","centralCircleOpacity","m","dataExtents","extent","userScale","log","canvasHeatmap","ctx","globalCompositeOperation","datumScale","getDatumScale","magnitudeScale","getMagnitudeScale","colorScale","beginPath","rect","fillStyle","closePath","colorMultiplier","aa","point","scaleOpacityDatum","circle","origin","angle","StackBlur","dataUrl","toDataURL","remove","getHeatmapData","dataCountries","feature","features","insert","legendCountry","dataByCountry","nest","key","entries","geoDatum","properties","matchedCountry","uDatum","values","rollupValue","Object","keys","setAttrValues","countryItem","each","targetPath","attrValue","attrKey","scaleDomain","Number","updateExtents","indiceChange","NaN","tooltip","activateTooltip","defaultGroupBy","dataMarkers","markerItem","markerObject","customTag","markerClassName","exit","transition","attrX","attrY","attrXDelta","attrYDelta","markerUpdate","hor","ver","ratio","deltaMarker","currentWidth","currentHeight","realHeight","realWidth","diffMarginWidth","diffMarginHeight","titleContainer","bgColor","source","html","originalTranslation","newTx","newTy","encodedTranslation","params","location","href","defaultZoomRaw","defaultZoom","JSON","parse","decodeURIComponent","decodeTranslation","event","message","encodeTranslation","exportedData","maxTransX","maxTransY","minTransX","minTransY","scaleAttributes","dataset","rollup","transform","useNegative","scaleFunction","scaleNegativeFunction","scaledValue","empty","originalValueRaw","originalValue","updateMarkers","updateCountries","updateTitle","updateHeatmap","fitContent","content","showing","total","inlineFilters","getDescription","innerHTML","tooltipNode","tooltipContent","circleRect","getBoundingClientRect","tooltipDelta","mouseLeft","left","mouseTop","top","svgXml","XMLSerializer","serializeToString","saveAs","blob","Blob","type","form","submit","exportNode","exportButton","exportForm","Filters","criteria","show","arrayDiff","columnDetails","join","activeColumns","filtersHeaderNode","filtersResetNode","display","marginLeft","reset","filtersTitleNode","createTextNode","filtersBodyNode","filtersElementsNode","filtersNewNode","add","evt","preventDefault","possibleFilters","getPossibleFilters","filterName","create","replaceNode","rowNode","buildRow","parentNode","replaceChild","push","render","toggle","removeChild","filterIndex","rowNodes","querySelectorAll","output","filtersChildren","childNodes","element","filterOutput","filterMethod","filterRangeSelect","filterValueMin","filterValueMax","filterValue","criterion","row","defaultCriteria","setFilters","outputArray","line","selectedIndex","separatorWord","that","minusButton","filterSeparator","filterNameSelect","utils","oldFilterName","getAttribute","newFilterName","refresh","filterVerb","filterRange","v","handleRangeChange","filterInput","filterInputType","filterValueAnd","filterSelect","uniqueValues","sortKeys","ascending","concat","except","isVirtual","matched","fmt","dataParse","exportFilters","filterNameSelects","visibility","disableNewFilter","Table","sorting","mode","isSorting","header","body","nowrap","sortColumn","defaultSorting","Array","isArray","applySort","uniqueCollapsedRows","rowClassName","tds","column","columnKey","cellContent","virtual","sortableColums","sort","compareBool","d3SortMode","descending","filterType","String","sortIndex","sortValue","shiftKey","MapTable","state","saveStateTimeout","json","loadData","csv","tsv","err","preFilter","setColumnDetails","isIE","navigator","userAgent","appVersion","insertBefore","firstChild","buildComponenents","errGeoMap","restoreState","stateName","stateData","clearTimeout","setTimeout","newUrl","stateHash","encodeURIComponent","stringify","history","pushState","filterData","defaultColumns","patternNumber","isNumber","test","columns","maptableObject","mapOptions","jsonPath","csvPath","tsvPath","filtersOptions","tableOptions","customOptions","defaultOptions"],"mappings":"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"}